# Запросы к внешней системе (REST)

## Работа с данными 1С

### Получение записей

#### Шаг: И Я ищу записи "Справочник.Пользователи" внешней системы "RAT_REST" по условиям

Метод: `ЯИщуЗаписиВнешнейСистемыПоУсловиям(ИмяТаблицы, ИмяНастройки, Условия)`

Выполняет запрос поиск данных во внешней системе.
В текущей версии можно выполнять поиск только на равенство реквизитов.

Результат: Массив записей таблицы удовлетворяющих условиям.

Параметры

| Параметр     | Описание                                                                                    | Примеры                                                             |
|--------------|---------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
| ИмяТаблицы   | Имя таблицы информационной базы 1С                                                          | Справочник.Пользователи, Документы.ЧекККМ, РегистрНакопления.Товары |
| ИмяНастройки | Имя настроенного источника данных                                                           |                                                                     |
| Условия      | Таблица условий поиска. Поддерживает 2 формата условий:                                     |                                                                     |
|              | Набор условий на равенство реквизита (первая колонка) конкретному значению (вторая колонка) |                                                                     |
|              | Либо таблица с возможностью указать `Реквизит`, `Значение`, `Условие`, `Тип`                |                                                                     |

Для задания условий возможно использовать два варианта

1. Структура условий поиска. Первая колонка - имя реквизита, вторая колонка - значение условия. При этом можно отбор можно накладывать на равенство реквизитов объекта указанным значения.
   Например

   ```gherkin
    | Наименование | Бла бла |
    | Номер        | 0001    |
    ```

2. Таблица условий. Оформляется в виде таблицы геркин с обязательным указанием имен колонок (Реквизит, Значение, Условие, Тип).

   * `Реквизит` - Имя реквизита, обязательное. Можно указывать имена реквизитов объект (`Номер`), его табличных частей (`Товары.Номенклатура`) и вложенных реквизитов (`Товары.Номенклатура.Вид`)
   * `Значение` - Значение, с которым сравниваем, необязательное.
   * `Условие` - Вид сравнения, доступные:
     * `Равно`
     * `Больше`
     * `БольшеИлиРавно`
     * `Меньше`
     * `МеньшеИлиРавно`
     * `ВСписке`
     * `Подобно`
     * `Содержит`
     * `НачинаетсяС`
     * `ЗаканчиваетсяНа`
     * `ВГруппе`
     * И все тоже самое с приставкой `Не` (слитно, `НеРавно`)
   * `Тип` - Тип значения, необязательное. При необходимости можно указать тип значения, например при фильтрации по составному реквизиту
   Например

   ```gherkin
    | Реквизит          | Условие | Значение  |
    | Ссылка            | ВГруппе | Документы |
    | ПометкаУдаления   | НеРавно | Истина    |
    | Тип               |         | Вид       |
    ```

Примеры

```gherkin
# Вернет ссылки на источники данных с типом соединения HTTP
И Я ищу записи "Справочник.Пользователи" внешней системы "RAT_REST" по условиям
  | Наименование    | Иванов Иван Иванович |
  | ПометкаУдаления | Ложь                 |

Когда Я ищу записи "Справочник.Метаданные" внешней системы "RAT_REST" по условиям
    | Реквизит          | Значение  | Условие |
    | Ссылка            | Документы | ВГруппе |
    | ПометкаУдаления   | Истина    | НеРавно |
    | Тип               | Вид       |         |
Когда Я ищу записи "Справочник.КатегорииОшибок" внешней системы "RAT_REST" по условиям
    | Реквизит                            | Значение       |
    | Ответственные.АдресЭлектроннойПочты | example@example.com |
```

```gherkin
# Предварительно подготовленная структура отбора, например для экспортных сценариев
И Я создаю структуру "Отбор"
  | ТипСоединения | СоединениеHTTP |
И Я ищу записи "Справочник.Пользователи" внешней системы "RAT_REST" по условиям "$Отбор$"
# Вернет ссылки на источники данных с типом соединения HTTP
```

```gherkin
# Предварительно подготовленная структура поиска
# Таким образом можно указать условия, выбираемые реквизиты, порядок сортировки и количество записей
И Я создаю структуру "Отбор"
  | ПометкаУдаления | Ложь                 |
И Я создаю массив "Реквизиты"
  | Код |
  | Наименование |
  | Сотрудник |
И Я создаю массив "Сортировка"
  | Наименование |
  | Код УБЫВ|
И Я создаю структуру "ПараметрыПоиска"
  | filter | $Отбор$ |
  | fields | $Реквизиты$ |
  | order | $Сортировка$ |
  | limit | 100 |
И Я ищу записи "Справочник.Пользователи" внешней системы "RAT_REST" по условиям "$ПараметрыПоиска$"
# Вернет ссылки помеченных на удаление пользователей, а также ссылку на связанного сотрудника
```

Также можно в качестве условий передавать готовый JSON. Примеры вы можете найти на странице [описания сервиса](http-service.md)

#### Шаг: И Я получаю запись "Справочник.Пользователи.ИмяПользователя" внешней системы "RAT_REST"

Метод: `ЯПолучаюЗаписьВнешнейСистемы(ИдентификаторЗаписи, ИмяНастройки)`

Возвращает данные найденного элемента.

Результат: Объект (структура) описывающий запись таблицы.

Параметры

| Параметр            | Описание                                                                                                                                                                                                                                     |
|---------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗаписи | Идентификатор записи. Состоит из двух частей - имя таблицы и уникальный идентификатор элемента. Например: `Справочник.Пользователи.ИмяПользователя`, `Документы.ЧекККМ.0001`, `РегистрНакопления.Товары.Склад=Основной;Номенклатура=0123456789` |
| ИмяНастройки        | Имя настроенного источника данных                                                                                                                                                                                                            |

Примеры

```gherkin
# Получение предопределенного элемента справочника
И Я получаю запись "Справочник.Пользователи.ИмяПользователя" внешней системы "RAT_REST"
# Получение документа по номеру (возвращает самый новый документ с указанным номером)
И Я получаю запись "Документ.ПКО.0000000001" внешней системы "RAT_REST"
# Получение записи регистра сведений по составному измерению
И Я получаю запись "РегистрыСведений.СтатусыДокументов.Документ=Документ.ПКО.0000000001" внешней системы "RAT_REST"
# Получение записи регистра сведений
И Я получаю запись "РегистрыСведений.СтатусыПКО.Документ=0000000001" внешней системы "RAT_REST"
```

#### Шаг: И Я получаю данные "Справочник.Пользователи" внешней системы "RAT_REST" по условиям

Метод: `ЯПолучаюДанныеВнешнейСистемыПоУсловиям(ИмяТаблицы, ИмяНастройки, Условия)`

### Проверка существования

#### Условие: И Если не существует запись "Справочник.Страны.$УникальноеИмяСтраны$" внешней системы "RAT_REST"

*@Deprecated*

Метод: `ЕслиНеСуществуетЗаписьВнешнейСистемы(ИдентификаторЗаписи, ИмяНастройки)`

Позволяет выполнять действия при отсутствии данных в информационной базе

Параметры

| Параметр            | Описание                                                                                       | Примеры                                                                                                                                   |
|---------------------|------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗаписи | Идентификатор записи. Состоит из двух частей - имя таблицы и уникальный идентификатор элемента | Справочник.Пользователи.ИмяПользователя, Документы.ЧекККМ.0001, РегистрНакопления.Товары.Склад=Основной;Номенклатура=0123456789 |
| ИмяНастройки        | Имя настроенного источника данных                                                              |                                                                                                                                           |

Примеры

```gherkin
И Если не существует запись "Справочник.Страны.Канада" внешней системы "RAT_REST"
  И Я создаю запись "Справочник.Страны" внешней системы "RAT_REST"
    | Наименование       | Канада |
    | НаименованиеПолное | Канада |
```

#### Условие: И Если не существует записей "Справочник.Страны" внешней системы "RAT_REST" по условиям

*@Deprecated*

Метод: `ЕслиНеСуществуетЗаписейВнешнейСистемыПоУсловиям(ИмяТаблицы, ИмяНастройки, Условия)`

Позволяет выполнять действия при отсутствии данных в информационной базе,
в отличии от шага `И Если не существует запись "Справочник.Страны.$УникальноеИмяСтраны$" внешней системы "RAT_REST"` можно возможно выполнить поиск по различным реквизитам

Параметры

| Параметр     | Описание                                                                                    | Примеры                                                                |
|--------------|---------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
| ИмяТаблицы   | Имя таблицы информационной базы 1С                                                          | Справочник.Пользователи, Документы.ЧекККМ, РегистрНакопления.Товары |
| ИмяНастройки | Имя настроенного источника данных                                                           |                                                                        |
| Условия      | Таблица условий поиска. Поддерживает 2 формата условий:                                     |                                                                        |
|              | Набор условий на равенство реквизита (первая колонка) конкретному значению (вторая колонка) |                                                                        |
|              | Либо таблица с возможностью указать `Реквизит`, `Значение`, `Условие`, `Тип`                |                                                                        |

Примеры

```gherkin
И Если не существует запись "РегистрыСведений.УчетФН" внешней системы "RAT_REST"
  | МодельФН | Mercury |
  И Я создаю запись "РегистрыСведений.УчетФН" внешней системы "RAT_REST"
    | ФискальныйНакопитель | ФН № 1                 |
    | МодельФН             | Mercury                |
    | ДатаПолучения        | '2021-01-01T22:00:00'  |
    | ЗаводскойНомер       | '00000000000000000001' |
```

#### Условие: Если существует запись "Справочник.Страны.Россия" внешней системы "RAT_REST" Тогда

Метод: `СуществуетЗаписьВнешнейСистемы(ИдентификаторЗаписи, ИмяНастройки)`

Проверяет наличие записи во внешней системе.

Параметры

| Параметр            | Описание                                                                                       | Примеры                                                                                                                                   |
|---------------------|------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗаписи | Идентификатор записи. Состоит из двух частей - имя таблицы и уникальный идентификатор элемента | Справочник.Пользователи.ИмяПользователя, Документы.ЧекККМ.0001, РегистрНакопления.Товары.Склад=Основной;Номенклатура=0123456789 |
| ИмяНастройки        | Имя настроенного источника данных                                                              |                                                                                                                                           |

Примеры

```gherkin
  Если существует запись "Справочник.Страны.$УникальноеИмяСтраны$" внешней системы "RAT_REST" Тогда
    И я вызываю исключение "Запись уже существует"
```

#### Условие: Если не существует запись "Справочник.Страны.Россия" внешней системы "RAT_REST" Тогда

Метод: `НеСуществуетЗаписьВнешнейСистемы(ИдентификаторЗаписи, ИмяНастройки)`

Проверяет отсутствие записи во внешней системе.

Параметры

| Параметр            | Описание                                                                                       | Примеры                                                                                                                                   |
|---------------------|------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗаписи | Идентификатор записи. Состоит из двух частей - имя таблицы и уникальный идентификатор элемента | Справочник.Пользователи.ИмяПользователя, Документы.ЧекККМ.0001, РегистрНакопления.Товары.Склад=Основной;Номенклатура=0123456789 |
| ИмяНастройки        | Имя настроенного источника данных                                                              |                                                                                                                                           |

Примеры

```gherkin
  Если не существует запись "Справочник.Страны.$УникальноеИмяСтраны$" внешней системы "RAT_REST" Тогда
    И Я создаю запись "Справочник.Страны" внешней системы "RAT_REST"
      | Наименование       | $УникальноеИмяСтраны$ |
```

#### Условие: Если существует запись "Справочник.Страны" внешней системы "RAT_REST" по условиям Тогда

Метод: `СуществуетЗаписьВнешнейСистемыПоУсловиям(ИмяТаблицы, ИмяНастройки, Условия)`

Проверяет наличие записи удовлетворяющих условиям во внешней системе.

Параметры

| Параметр     | Описание                                                                                    | Примеры                                                                |
|--------------|---------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
| ИмяТаблицы   | Имя таблицы информационной базы 1С                                                          | Справочник.Пользователи, Документы.ЧекККМ, РегистрНакопления.Товары |
| ИмяНастройки | Имя настроенного источника данных                                                           |                                                                        |
| Условия      | Таблица условий поиска. Поддерживает 2 формата условий:                                     |                                                                        |
|              | Набор условий на равенство реквизита (первая колонка) конкретному значению (вторая колонка) |                                                                        |
|              | Либо таблица с возможностью указать `Реквизит`, `Значение`, `Условие`, `Тип`                |                                                                        |

Примеры

```gherkin
  Если существует запись "Справочник.Страны" внешней системы "RAT_REST" по условиям Тогда
    | Наименование       | $УникальноеИмяСтраны$ |
    И я вызываю исключение "Запись уже существует"
```

#### Условие: Если не существует запись "Справочник.Страны" внешней системы "RAT_REST" по условиям Тогда

Метод: `НеСуществуетЗаписьВнешнейСистемыПоУсловиям(ИмяТаблицы, ИмяНастройки, Условия)`

Проверяет отсутствие записей удовлетворяющих условиям во внешней системе.

Параметры

| Параметр     | Описание                                                                                    | Примеры                                                                |
|--------------|---------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
| ИмяТаблицы   | Имя таблицы информационной базы 1С                                                          | Справочник.Пользователи, Документы.ЧекККМ, РегистрНакопления.Товары |
| ИмяНастройки | Имя настроенного источника данных                                                           |                                                                        |
| Условия      | Таблица условий поиска. Поддерживает 2 формата условий:                                     |                                                                        |
|              | Набор условий на равенство реквизита (первая колонка) конкретному значению (вторая колонка) |                                                                        |
|              | Либо таблица с возможностью указать `Реквизит`, `Значение`, `Условие`, `Тип`                |                                                                        |

Примеры

```gherkin
  Если не существует запись "Справочник.Страны" внешней системы "RAT_REST" по условиям Тогда
    | Реквизит     | Значение              | Условие| Тип    |
    | Наименование | $УникальноеИмяСтраны$ | Равно  | Строка |
    И я вызываю исключение "Запись не создана"
```

### Создание записей

#### Шаг: И Я создаю запись "Справочник.Пользователи" внешней системы "RAT_REST"

Метод: `ЯСоздаюЗаписьВнешнейСистемы(ИмяТаблицы, ИмяНастройки, Данные)`

Создает новый элемент информационной базы и возвращает идентификатор созданного элемента (ссылка или ключ записи)

Некоторые особенности для разных типов объектов.

Создание документов

* Если не указана дата или номер, они будут автоматически присвоены новому объекту
* Если реквизит "Проведен" установлен в "Истина" новый документ будет проведен (а не просто установлен этот признак).

Создание бизнес-процессов и задач

* Если не указана дата или номер, они будут автоматически присвоены новому объекту

Создание записей регистров

* Запись регистров происходит с замещением. Поэтому если данные в базе уже существуют, то вы не получите ошибку, данные будут просто замены новыми.

Для любых ссылочных объектов (не регистров) возможно создание объектов с указанием идентификатора ссылки. Для этого нужно передать реквизит "Ссылка" указав идентификатор

Результат: Ссылка на созданный объект.
Ссылка представлена в виде объекта с реквизитами:

* type - Тип ссылки
* id - Уникальный идентификатор или ключ записи регистра
* presentation - Представление ссылки

Параметры

| Параметр     | Описание                                                                                                                |
|--------------|-------------------------------------------------------------------------------------------------------------------------|
| ИмяТаблицы   | Имя таблицы информационной базы 1С, например: `Справочник.Пользователи`, `Документы.ЧекККМ`, `РегистрНакопления.Товары` |
| ИмяНастройки | Имя настроенного источника данных                                                                                       |
| Данные       | Таблица данных. Первая колонка - имя реквизита, вторая - значение                                                       |

Примеры

```gherkin
# Создание 
И Я создаю запись "Справочник.Пользователи" внешней системы "RAT_REST"
  | Наименование | Иванов Иван Иванович |
  | Сотрудник    | Иванов Иван Иванович |
  | Код          | Иванов Иван          |

# Создание объекта с табличной частью
И Я создаю таблицу данных "ТоварыУслуги"
  | ОтделЧека | Номенклатура          | Количество | Цена   | Сумма  | СуммаНДС | СтавкаНДС | ПризнакСпособаРасчета | ПризнакПредметаРасчета |
  | 1         | $НоменклатураЧекаККМ$ | 1          | 102.99 | 102.99 | 20.1     | НДС18     |                       |                        |
  | 1         | $НоменклатураЧекаККМ$ | 5          | 102.99 | 102.99 | 20.1     | НДС18     |                       |                        |

И Я создаю структуру "ДанныеЧека"
  | ВидОперации     | Приход          |
  | КассоваяСмена   | $КассоваяСмена$ |
  | НомерЧекаВСмене | 1               |
  | ТоварыУслуги    | $ТоварыУслуги$  |

И Я создаю запись "Документ.ЧекККМ" внешней системы "RAT_REST"
  | ВидОперации     | Приход          |
  | КассоваяСмена   | $КассоваяСмена$ |
  | НомерЧекаВСмене | 1               |
  | ТоварыУслуги    | $ТоварыУслуги$  |

# Создание объекта из переменной
И Я создаю запись "Документ.ЧекККМ" внешней системы "RAT_REST" "$ДанныеЧека$"

# Создание записи регистра
И Я создаю запись "РегистрСведений.АдресныеСокращения" внешней системы "RAT_REST"
  | Уровень      | 1     |
  | Сокращение   | 'г'   |
  | Наименование | город |

# Создание с указанием ссылки
И Я создаю запись "Справочник.Пользователи" внешней системы "RAT_REST"
  | Ссылка       | a772d037-9519-4c2b-8c9b-ad9de187fe90 |
  | Наименование | Иванов Иван Иванович                 |
  | Сотрудник    | Иванов Иван Иванович                 |
  | Код          | Иванов Иван                          |
```

#### Шаг: И Я создаю записи "Справочник.Пользователи" внешней системы "RAT_REST"

Метод: `ЯСоздаюЗаписиВнешнейСистемы(ИмяТаблицы, ИмяНастройки, Данные)`

### Изменение записей

#### Шаг: И Я изменяю запись "Справочник.Пользователи.ИмяПользователя" внешней системы "RAT_REST"

Метод: `ЯИзменяюЗаписьВнешнейСистемы(ИдентификаторЗаписи, ИмяНастройки, Данные)`

Предоставляет функциональность для изменения данных объектов информационной базы.
Для изменения вам нужно указать [идентификатор объекта](ФорматыДанных.md#идентификатор-объекта) и перечень изменяемых реквизитов.
Если вам требуется изменить табличную часть, то придется передать ее полностью (при изменении ТЧ она очищается и заполняется по переданным данным)

Параметры

| Параметр            | Описание                                                                                                                                                                                                                                                  |
|---------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗаписи | Идентификатор записи. Состоит из двух частей - имя таблицы и уникальный идентификатор элемента. Например: `Справочник.Пользователи.ИмяПользователя`, `Документы.ЧекККМ.0001`, `РегистрНакопления.Товары.Склад=Основной;Номенклатура=0123456789` |
| ИмяНастройки        | Имя настроенного источника данных                                                                                                                                                                                                                         |
| Данные              | Таблица данных. Первая колонка - имя реквизита, вторая - значение. Не обязательно указывать данные всех реквизитов, достаточно указать только модифицируемые значения                                                                                     |

Примеры

```gherkin
# Изменение реквизитов объекта 
И Я изменяю запись "Справочник.ИсточникиДанных.RAT_REST" внешней системы "RAT_REST"
  | Использовать    | Ложь   |
  | ПометкаУдаления | Истина |
# Изменение табличной части объекта
И Я создаю таблицу данных "ТоварыУслуги"
  | ОтделЧека | Номенклатура          | Количество | Цена   | Сумма  | СуммаНДС | СтавкаНДС | ПризнакСпособаРасчета | ПризнакПредметаРасчета |
  | 1         | $НоменклатураЧекаККМ$ | 1          | 102.99 | 102.99 | 20.1     | НДС20     |                       |                        |
  | 1         | $НоменклатураЧекаККМ$ | 5          | 102.99 | 102.99 | 20.1     | НДС20     |                       |                        |
И Я изменяю запись "Документ.ЧекККМ.00000001" внешней системы "RAT_REST"
  | ТоварыУслуги    | $ТоварыУслуги$  |
# Изменение записи регистра
И Я изменяю запись "РегистрСведений.АдресныеСокращения.Уровень=1;Сокращение=г" внешней системы "RAT_REST"
  | Уровень      | 1     |
  | Сокращение   | 'г'   |
  | Наименование | Город |
```

#### Шаг: И Я изменяю записи "Справочник.Пользователи" внешней системы "RAT_REST" соответствующие отбору "$Отбор$" установив"

Метод: `ЯИзменяюЗаписиВнешнейСистемыСоответствующиеОтборуУстановив(ИмяТаблицы, ИмяНастройки, Отбор, НовыеЗначения)`

### Удаление записей

#### Шаг: И Я удаляю запись "Справочник.Пользователи.ИмяПользователя" внешней системы "RAT_REST"

Метод: `ЯУдаляюЗаписьВнешнейСистемы(ИдентификаторЗаписи, ИмяНастройки)`

Помечает на удаление объект или удаляет строку регистра

Параметры

| Параметр            | Описание                                                                                       | Примеры                                                                                                                                   |
|---------------------|------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗаписи | Идентификатор записи. Состоит из двух частей - имя таблицы и уникальный идентификатор элемента | Справочник.Пользователи.ИмяПользователя, Документы.ЧекККМ.0001, РегистрНакопления.Товары.Склад=Основной;Номенклатура=0123456789 |
| ИмяНастройки        | Имя настроенного источника данных                                                              |                                                                                                                                           |

Примеры

```gherkin
# Удаление справочника
И Я удаляю запись "Справочник.Пользователи.RAT_REST" внешней системы "RAT_REST"
# Удаление документа
И Я удаляю запись "Документ.ЧекККМ.00000001" внешней системы "RAT_REST"
# Удаление записи регистра
И Я удаляю запись "РегистрСведений.АдресныеСокращения.Уровень=1;Сокращение=г" внешней системы "RAT_REST"
```

#### Шаг: Тогда Я удаляю записи "РегистрСведений.АдресныеСокращения" внешней системы "RAT_REST" соответствующие отбору

Метод: `ЯУдаляюЗаписиВнешнейСистемыСоответствующиеОтбору(ИмяТаблицы, ИмяНастройки, Отбор)`

### Табличные части объектов

#### Шаг: И Я получаю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.Иванов" внешней системы "RAT_REST"

Метод: `ЯПолучаюСтрокиТабличнойЧастиОбъектаВнешнейСистемы(ИмяТабличнойЧасти, ИдентификаторЗаписи, ИмяНастройки)`

Получает данные табличной части объекта

Параметры

| Параметр            | Описание                                                                                       | Примеры                                                                                                                                   |
|---------------------|------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| ИмяТабличнойЧасти   | Имя или синоним табличной части.                                                               |                                                                                                                                           |
| ИдентификаторЗаписи | Идентификатор записи. Состоит из двух частей - имя таблицы и уникальный идентификатор элемента | Справочник.Пользователи.ИмяПользователя, Документы.ЧекККМ.0001, РегистрНакопления.Товары.Склад=Основной;Номенклатура=0123456789 |
| ИмяНастройки        | Имя настроенного источника данных                                                              |                                                                                                                                           |

Примеры

```gherkin
Когда Я добавляю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.$Идентификатор$" внешней системы "RAT_REST"
  | ВидКонтактнойИнформации | Значение       |
  | Телефон                 | +79123456789   |
  | АдресЭлектроннойПочты   | mail@email.com |
Тогда Я получаю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.$Идентификатор$" внешней системы "RAT_REST"
И количество элементов результата запроса равно "2"
И реквизит результата запроса "[0].Значение" равен "+79123456789"
И реквизит результата запроса "[1].Значение" равен "mail@email.com"
```

#### Шаг: И Я добавляю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.Иванов" внешней системы "RAT_REST"

Метод: `ЯДобавляюСтрокиТабличнойЧастиОбъектаВнешнейСистемы(ИмяТабличнойЧасти, ИдентификаторЗаписи, ИмяНастройки, ДанныеТабличнойЧасти)`

Добавляет записи в табличную часть объекта

Параметры

| Параметр             | Описание                                                                                                                                        | Примеры                                                                                                                                   |
|----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| ИмяТабличнойЧасти    | Имя или синоним табличной части.                                                                                                                |                                                                                                                                           |
| ИдентификаторЗаписи  | Идентификатор записи. Состоит из двух частей - имя таблицы и уникальный идентификатор элемента                                                  | Справочник.Пользователи.ИмяПользователя, Документы.ЧекККМ.0001, РегистрНакопления.Товары.Склад=Основной;Номенклатура=0123456789 |
| ИмяНастройки         | Имя настроенного источника данных                                                                                                               |                                                                                                                                           |
| ДанныеТабличнойЧасти | ДОбавляемые строки табличной части. Колонки соответствуют колонкам табличной части (можно использовать имена и синонимы), а строки - строкам ТЧ |                                                                                                                                           |

Примеры

```gherkin
Когда Я добавляю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.$Идентификатор$" внешней системы "RAT_REST"
  | ВидКонтактнойИнформации | Значение       |
  | Телефон                 | +79123456789   |
  | АдресЭлектроннойПочты   | mail@email.com |
Тогда Я получаю запись "Справочник.Пользователи.$Идентификатор$" внешней системы "RAT_REST"
И реквизит результата запроса "КонтактнаяИнформация[0].Значение" равен "+79123456789"
И реквизит результата запроса "КонтактнаяИнформация[1].Значение" равен "mail@email.com"
```

#### Шаг: И Я удаляю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.Иванов" внешней системы "RAT_REST" по отбору

Метод: `ЯУдаляюСтрокиТабличнойЧастиОбъектаВнешнейСистемыПоОтбору(ИмяТабличнойЧасти, ИдентификаторЗаписи, ИмяНастройки, Отбор)`

Удаляет данные табличной части объекта соответствующие отбору

Параметры

| Параметр            | Описание                                                                                       | Примеры                                                                                                                                   |
|---------------------|------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| ИмяТабличнойЧасти   | Имя или синоним табличной части.                                                               |                                                                                                                                           |
| ИдентификаторЗаписи | Идентификатор записи. Состоит из двух частей - имя таблицы и уникальный идентификатор элемента | Справочник.Пользователи.ИмяПользователя, Документы.ЧекККМ.0001, РегистрНакопления.Товары.Склад=Основной;Номенклатура=0123456789 |
| ИмяНастройки        | Имя настроенного источника данных                                                              |                                                                                                                                           |
| Отбор               | Таблица условий поиска. Поддерживает 2 формата условий:                                        |                                                                                                                                           |
|                     | Набор условий на равенство реквизита (первая колонка) конкретному значению (вторая колонка)    |                                                                                                                                           |
|                     | Либо таблица с возможностью указать `Реквизит`, `Значение`, `Условие`, `Тип`                   |                                                                                                                                           |

Примеры

```gherkin
Когда Я удаляю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.$Идентификатор$" внешней системы "RAT_REST" по отбору
  | НомерСтроки | 1 |
```

#### Шаг: И Я очищаю табличную часть "КонтактнаяИнформация" объекта "Справочник.Пользователи.Иванов" внешней системы "RAT_REST"

Метод: `ЯОчищаюТабличнуюЧастьОбъектаВнешнейСистемы(ИмяТабличнойЧасти, ИдентификаторЗаписи, ИмяНастройки)`

Удаляет все данные табличной части объекта

Параметры

| Параметр            | Описание                                                                                       | Примеры                                                                                                                                   |
|---------------------|------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| ИмяТабличнойЧасти   | Имя или синоним табличной части.                                                               |                                                                                                                                           |
| ИдентификаторЗаписи | Идентификатор записи. Состоит из двух частей - имя таблицы и уникальный идентификатор элемента | Справочник.Пользователи.ИмяПользователя, Документы.ЧекККМ.0001, РегистрНакопления.Товары.Склад=Основной;Номенклатура=0123456789 |
| ИмяНастройки        | Имя настроенного источника данных                                                              |                                                                                                                                           |

Примеры

```gherkin
  Когда Я очищаю табличную часть "КонтактнаяИнформация" объекта "Справочник.Пользователи.$Идентификатор$" внешней системы "RAT_REST"
  Тогда Я получаю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.$Идентификатор$" внешней системы "RAT_REST"
  И количество элементов результата запроса равно "0"
```

#### Шаг: И Я изменяю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.Иванов" внешней системы "RAT_REST" с ключевыми полями "НомерСтроки"

Метод: `ЯИзменяюСтрокиТабличнойЧастиОбъектаВнешнейСистемыСКлючевымиПолями(ИмяТабличнойЧасти, ИдентификаторЗаписи, ИмяНастройки, КлючевыеПоля, Данные)`

Изменяет данные табличной части объекта соответствующие отбору

Параметры

| Параметр             | Описание                                                                                                                                                        | Примеры                                                                                                                                   |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| ИмяТабличнойЧасти    | Имя или синоним табличной части.                                                                                                                                |                                                                                                                                           |
| ИдентификаторЗаписи  | Идентификатор записи. Состоит из двух частей - имя таблицы и уникальный идентификатор элемента                                                                  | Справочник.Пользователи.ИмяПользователя, Документы.ЧекККМ.0001, РегистрНакопления.Товары.Склад=Основной;Номенклатура=0123456789 |
| ИмяНастройки         | Имя настроенного источника данных                                                                                                                               |                                                                                                                                           |
| ДанныеТабличнойЧасти | Новые значения реквизитов, а также значения поиска. Колонки соответствуют колонкам табличной части (можно использовать имена и синонимы), а строки - строкам ТЧ |                                                                                                                                           |

Примеры

```gherkin
Когда Я изменяю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.$Идентификатор$" внешней системы "RAT_REST" с ключевыми полями "ВидКонтактнойИнформации"
  | ВидКонтактнойИнформации | Значение |
  | ФактическийАдрес        | Спб      |
```

#### Шаг: И Я изменяю или добавляю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.Иванов" внешней системы "RAT_REST" с ключевыми полями "НомерСтроки"

Метод: `ЯИзменяюИлиДобавляюСтрокиТабличнойЧастиОбъектаВнешнейСистемыСКлючевымиПолями(ИмяТабличнойЧасти, ИдентификаторЗаписи, ИмяНастройки, КлючевыеПоля, Данные)`

Изменяет данные табличной части объекта соответствующие отбору или добавляет новые строки при отсутствии строк соответствующих отбору

Параметры

| Параметр             | Описание                                                                                                                                                        | Примеры                                                                                                                                   |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| ИмяТабличнойЧасти    | Имя или синоним табличной части.                                                                                                                                |                                                                                                                                           |
| ИдентификаторЗаписи  | Идентификатор записи. Состоит из двух частей - имя таблицы и уникальный идентификатор элемента                                                                  | Справочник.Пользователи.ИмяПользователя, Документы.ЧекККМ.0001, РегистрНакопления.Товары.Склад=Основной;Номенклатура=0123456789 |
| ИмяНастройки         | Имя настроенного источника данных                                                                                                                               |                                                                                                                                           |
| ДанныеТабличнойЧасти | Новые значения реквизитов, а также значения поиска. Колонки соответствуют колонкам табличной части (можно использовать имена и синонимы), а строки - строкам ТЧ |                                                                                                                                           |

Примеры

```gherkin
Когда Я изменяю или добавляю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.$Идентификатор$" внешней системы "RAT_REST" с ключевыми полями "ВидКонтактнойИнформации"
  | ВидКонтактнойИнформации | Значение       |
  | Телефон                 | "+79123456789" |
Тогда Я получаю строки табличной части "КонтактнаяИнформация" объекта "Справочник.Пользователи.$Идентификатор$" внешней системы "RAT_REST"
И количество элементов результата запроса равно "3"
И реквизит результата запроса "[2].Значение" равен "+79123456789"
```

### Движения документов

#### Шаг: И Я получаю движения документа "ПКО.0000000001" внешней системы "RAT_REST"

Метод: `ЯПолучаюДвиженияДокументаВнешнейСистемы(ИдентификаторДокумента, ИмяНастройки)`

Получает данные всех движений документа. Движения собраны в структуру,
ключ - имя регистра, в который пишет документ, значение - коллекция движений документа по этому регистру

Параметры

| Параметр               | Описание                                                                                            | Примеры                                                     |
|------------------------|-----------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
| ИдентификаторДокумента | Идентификатор документа. Состоит из двух частей - тип документа и уникальный идентификатор элемента | ЧекККМ.0001, ПКО.a772d037-9519-4c2b-8c9b-ad9de187fe90 |
| ИмяНастройки           | Имя настроенного источника данных                                                                   |                                                             |

Примеры

```gherkin
# Получение движений
И Я получаю движения документа "ПКО.0000000001" внешней системы "RAT_REST"
# Работа с результатом, проверим суммы и виды движений
И реквизит результата запроса "ВзаиморасчетыСКлиентами[0].Сумма" равен "1000"
И реквизит результата запроса "ВзаиморасчетыСКлиентами[0].ВидДвижения" равен "Receipt"
И реквизит результата запроса "ВзаиморасчетыСКлиентамиЗакрытые[0].Сумма" равен "1000"
И реквизит результата запроса "ВзаиморасчетыСКлиентамиЗакрытые[0].ВидДвижения" равен "Expense"
```

#### Шаг: И Я получаю движения документа "ПКО.0000000001" по регистру "ВзаиморасчетыМФУЗакрытые" внешней системы "RAT_REST"

Метод: `ЯПолучаюДвиженияДокументаПоРегиструВнешнейСистемы(ИдентификаторДокумента, ИмяРегистра, ИмяНастройки)`

Получает данные движений документа по регистру.

Параметры

| Параметр               | Описание                                                                                                                                                                    | Примеры                                                     |
|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
| ИдентификаторДокумента | Идентификатор документа. Состоит из двух частей - тип документа и уникальный идентификатор элемента                                                                         | ЧекККМ.0001, ПКО.a772d037-9519-4c2b-8c9b-ad9de187fe90 |
| ИмяРегистра            | Имя регистра, по которому пишет документ. Список доступных регистров можно посмотреть в конфигураторе или спеки, также в тексте ошибки, при не корректном указании регистра | ВзаиморасчетыСКлиентами, ТоварыНаСкладах                    |
| ИмяНастройки           | Имя настроенного источника данных                                                                                                                                           |                                                             |

Примеры

```gherkin
# Получение движений ВзаиморасчетыСКлиентами
И Я получаю движения документа "ПКО.0000000001"по регистру "ВзаиморасчетыСКлиентами" внешней системы "RAT_REST"
```

#### Шаг: И Я изменяю движения документа "ПКО.0000000001" по регистру "ВзаиморасчетыМФУЗакрытые" внешней системы "RAT_REST"

Метод: `ЯИзменяюДвиженияДокументаПоРегиструВнешнейСистемы(ИдентификаторДокумента, ИмяРегистра, ИмяНастройки, Данные)`

Подменяет движения документа без перепроведения.

Параметры

| Параметр               | Описание                                                                                                                                                                    | Примеры                                                     |
|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
| ИдентификаторДокумента | Идентификатор документа. Состоит из двух частей - тип документа и уникальный идентификатор элемента                                                                         | ЧекККМ.0001, ПКО.a772d037-9519-4c2b-8c9b-ad9de187fe90 |
| ИмяРегистра            | Имя регистра, по которому пишет документ. Список доступных регистров можно посмотреть в конфигураторе или спеки, также в тексте ошибки, при не корректном указании регистра | ВзаиморасчетыСКлиентами, ТоварыНаСкладах                    |
| ИмяНастройки           | Имя настроенного источника данных                                                                                                                                           |                                                             |
| Данные                 | Таблица движений регистра                                                                                                                                                   |                                                             |

Примеры

```gherkin
И Я изменяю движения документа "ПКО.0000000001" по регистру "ВзаиморасчетыСКонтрагентами" внешней системы "RAT_REST"
| ВидДвижения | Контрагент  | Сумма |
| Приход      | Иванов И.И. | 543   |
| Приход      | Петров П.П. | 543   |
```

### Проведение документов

#### Шаг: И Я провожу документ "ПКО.0000000001" внешней системы "RAT_REST"

Метод: `ЯПровожуДокументВнешнейСистемы(ИдентификаторДокумента, ИмяНастройки)`

Выполняет проведение указанного документа

Параметры

| Параметр               | Описание                                                                                            | Примеры                                                     |
|------------------------|-----------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
| ИдентификаторДокумента | Идентификатор документа. Состоит из двух частей - тип документа и уникальный идентификатор элемента | ЧекККМ.0001, ПКО.a772d037-9519-4c2b-8c9b-ad9de187fe90 |
| ИмяНастройки           | Имя настроенного источника данных                                                                   |                                                             |

Примеры

```gherkin
И Я провожу документ "ЧекККМ.000001" внешней системы "RAT_REST"
```

#### Шаг: И Я отменяю проведение документа "ПКО.0000000001" внешней системы "RAT_REST"

Метод: `ЯОтменяюПроведениеДокументаВнешнейСистемы(ИдентификаторДокумента, ИмяНастройки)`

Отменяет проведение указанного документа

Параметры

| Параметр               | Описание                                                                                            | Примеры                                                     |
|------------------------|-----------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
| ИдентификаторДокумента | Идентификатор документа. Состоит из двух частей - тип документа и уникальный идентификатор элемента | ЧекККМ.0001, ПКО.a772d037-9519-4c2b-8c9b-ad9de187fe90 |
| ИмяНастройки           | Имя настроенного источника данных                                                                   |                                                             |

Примеры

```gherkin
И Я отменяю проведение документа "ЧекККМ.000001" внешней системы "RAT_REST"
```

### Остатки регистров

#### Шаг: И Я получаю остатки "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" по условиям

Выполняет запрос на получение остатков регистра по заданным условиям.

Возвращяет таблицу остаков по всем измерениям и ресурсам соответствующим указанным условиям.

Метод: `ЯПолучаюОстаткиВнешнейСистемыПоУсловиям(ИмяТаблицы, ИмяНастройки, Условия)`

Результат: Массив записей остатков.
Каждая запись содержит значения измерений и ресурсов (с суффиксом остаток), подробнее смотрите в спецификации

Параметры

| Параметр     | Описание                                                                                       |
|--------------|------------------------------------------------------------------------------------------------|
| ИмяТаблицы   | Имя таблицы информационной базы 1С, например `РегистрНакопления.Товары`                        |
| ИмяНастройки | Имя настроенного источника данных                                                              |
| Условия      | Таблица условий (первая колонка - имя реквизита, вторая - значение) или переменная с условиями |

Примеры

```gherkin
И Я получаю остатки "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" по условиям
  | КассоваяСмена   | $КассоваяСмена$ |
```

```gherkin
И Я создаю структуру "Условия"
  | КассоваяСмена   | $КассоваяСмена$ |
И Я получаю остатки "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" по условиям "$Условия$"
```

#### Шаг: И Я получаю агрегированные остатки "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" по условиям

Выполняет запрос на получение остатков регистра по заданным условиям.

Возвращяет массив с одной записью, суммированные остаки по всем ресурсам соответствующим указанным условиям.

Метод: `ЯПолучаюАгрегированныеОстаткиВнешнейСистемыПоУсловиям(ИмяТаблицы, ИмяНастройки, Условия)`

Результат: Массив с одной записью остатков, ключ - имя ресурса с суффиксом **остаток**, подробнее смотрите в спецификации

Параметры

| Параметр     | Описание                                                                                       |
|--------------|------------------------------------------------------------------------------------------------|
| ИмяТаблицы   | Имя таблицы информационной базы 1С, например `РегистрНакопления.Товары`                        |
| ИмяНастройки | Имя настроенного источника данных                                                              |
| Условия      | Таблица условий (первая колонка - имя реквизита, вторая - значение) или переменная с условиями |

Примеры

```gherkin
И Я получаю агрегированные остатки "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" по условиям
  | КассоваяСмена   | $КассоваяСмена$ |
```

```gherkin
И Я создаю структуру "Условия"
  | КассоваяСмена   | $КассоваяСмена$ |
И Я получаю агрегированные остатки "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" по условиям "$Условия$"
```

#### Шаг: И Я получаю остатки "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" на "Дата" по условиям

Выполняет запрос на получение остатков регистра по заданным условиям на конкретную дату

Метод: `ЯПолучаюОстаткиВнешнейСистемыНаПоУсловиям(ИмяТаблицы, ИмяНастройки, Дата, Условия)`

Результат: Массив записей остатков.
Каждая запись содержит значения измерений и ресурсов (с суффиксом остаток), подробнее смотрите в спецификации

Параметры

| Параметр     | Описание                                                                                       |
|--------------|------------------------------------------------------------------------------------------------|
| ИмяТаблицы   | Имя таблицы информационной базы 1С, например `РегистрНакопления.Товары`                        |
| ИмяНастройки | Имя настроенного источника данных                                                              |
| Дата         | Дата, на начало которой необходимо получить остатки                                            |
| Условия      | Таблица условий (первая колонка - имя реквизита, вторая - значение) или переменная с условиями |

Примеры

```gherkin
И Я получаю остатки "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" на "{ТекущаяДата()}" по условиям
  | КассоваяСмена   | $КассоваяСмена$ |
```

```gherkin
И Я создаю структуру "Условия"
  | КассоваяСмена   | $КассоваяСмена$ |
И Я получаю остатки "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" на "$ДатаОстатков$" по условиям "$Условия$"
```

### Обороты регистров

#### Шаг: И Я получаю обороты "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" с периодичностью "Регистратор" по условиям

Выполняет запрос на получение оборотов по регистру по заданным условиям

Метод: `ЯПолучаюОборотыВнешнейСистемыСПериодичностьюПоУсловиям(ИмяТаблицы, ИмяНастройки, Периодичность, Условия)`

Результат: Массив записей оборотов.
Каждая запись содержит значения измерений и ресурсов (с суффиксом обороты), подробнее смотрите в спецификации

Параметры

| Параметр      | Описание                                                                                                                                                                                                                                             |
|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ИмяТаблицы    | Имя таблицы информационной базы 1С, например `РегистрНакопления.Товары`                                                                                                                                                                              |
| ИмяНастройки  | Имя настроенного источника данных                                                                                                                                                                                                                    |
| Периодичность | Периодичность оборотов, указывается дополнительный разворот оборотов по периодичности. Возможные значения: `Период`, `Запись`, `Регистратор`, `Секунда`, `Минута`, `Час`, `День`, `Неделя`, `Декада`, `Месяц`, `Квартал`, `Полугодие`, `Год`, `Авто` |
| Условия       | Таблица условий (первая колонка - имя реквизита, вторая - значение) или переменная с условиями                                                                                                                                                       |

Примеры

```gherkin
Когда Я получаю обороты "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" с периодичностью "регистратор" по условиям
  | КассоваяСмена   | $КассоваяСмена$ |
```

```gherkin
Дано Я создаю структуру "Условия"
  | КассоваяСмена   | $КассоваяСмена$ |
Когда Я получаю обороты "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" с периодичностью "регистратор" по условиям "$Условия$"
Тогда реквизит результата запроса "[0].КоличествоЧековОборот" равен "1"
И реквизит результата запроса "[0].СуммаСменыОборот" равен "15"
И реквизит результата запроса "[1].СуммаСменыОборот" равен "30"
```

#### Шаг: И Я получаю агрегированные обороты "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" с периодичностью "Регистратор" по условиям

Выполняет запрос на получение агрегированных оборотов по регистру по заданным условиям без разреза по измерениям

Метод: `ЯПолучаюАгрегированныеОборотыВнешнейСистемыСПериодичностьюПоУсловиям(ИмяТаблицы, ИмяНастройки, Периодичность, Условия)`

Результат: Массив записей оборотов.
Каждая запись содержит значения периода (если периодичность не равна "Период") и обороты ресурсов, подробнее смотрите в спецификации

Параметры

| Параметр      | Описание                                                                                                                                                                                                                                             |
|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ИмяТаблицы    | Имя таблицы информационной базы 1С, например `РегистрНакопления.Товары`                                                                                                                                                                              |
| ИмяНастройки  | Имя настроенного источника данных                                                                                                                                                                                                                    |
| Периодичность | Периодичность оборотов, указывается дополнительный разворот оборотов по периодичности. Возможные значения: `Период`, `Запись`, `Регистратор`, `Секунда`, `Минута`, `Час`, `День`, `Неделя`, `Декада`, `Месяц`, `Квартал`, `Полугодие`, `Год`, `Авто` |
| Условия       | Таблица условий (первая колонка - имя реквизита, вторая - значение) или переменная с условиями                                                                                                                                                       |

Примеры

```gherkin
Когда Я получаю агрегированные обороты "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" с периодичностью "регистратор" по условиям
  | КассоваяСмена   | $КассоваяСмена$ |
```

```gherkin
Дано Я создаю структуру "Условия"
  | КассоваяСмена   | $КассоваяСмена$ |
Когда Я получаю агрегированные обороты "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" с периодичностью "регистратор" по условиям "$Условия$"
Тогда реквизит результата запроса "[0].КоличествоЧековОборот" равен "1"
И реквизит результата запроса "[0].СуммаСменыОборот" равен "15"
И реквизит результата запроса "[1].СуммаСменыОборот" равен "30"
```

#### Шаг: И Я получаю остатки и обороты "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" с периодичностью "Регистратор" по условиям

Выполняет запрос на получение остатков и оборотов по регистру по заданным условиям

Метод: `ЯПолучаюОстаткиИОборотыВнешнейСистемыСПериодичностьюПоУсловиям(ИмяТаблицы, ИмяНастройки, Периодичность, Условия)`

Результат: Массив записей остатков и оборотов.
Каждая запись содержит значения измерений, ресурсов на начало и конец периода (с суффиксом НачальныйОстаток и КонечныйОстаток) и оборотов по ним (с суффиксом обороты).
Подробнее смотрите в спецификации

Параметры

| Параметр      | Описание                                                                                                                                                                                                                                             |
|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ИмяТаблицы    | Имя таблицы информационной базы 1С, например `РегистрНакопления.Товары`                                                                                                                                                                              |
| ИмяНастройки  | Имя настроенного источника данных                                                                                                                                                                                                                    |
| Периодичность | Периодичность оборотов, указывается дополнительный разворот оборотов по периодичности. Возможные значения: `Период`, `Запись`, `Регистратор`, `Секунда`, `Минута`, `Час`, `День`, `Неделя`, `Декада`, `Месяц`, `Квартал`, `Полугодие`, `Год`, `Авто` |
| Условия       | Таблица условий (первая колонка - имя реквизита, вторая - значение) или переменная с условиями                                                                                                                                                       |

Примеры

```gherkin
Когда Я получаю обороты "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" с периодичностью "регистратор" по условиям
  | КассоваяСмена   | $КассоваяСмена$ |
Тогда реквизит результата запроса "[0].КоличествоЧековНачальныйОстаток" равен "0"
И реквизит результата запроса "[0].КоличествоЧековОборот" равен "2"
И реквизит результата запроса "[0].СуммаСменыОборот" равен "45"
И реквизит результата запроса "[0].КоличествоЧековКонечныйОстаток" равен "2"
И реквизит результата запроса "[0].СуммаСменыКонечныйОстаток" равен "45"
```

```gherkin
Дано Я создаю структуру "Условия"
  | КассоваяСмена   | $КассоваяСмена$ |
Когда Я получаю обороты "РегистрНакопления.КассовыеСмены" внешней системы "RAT_REST" с периодичностью "регистратор" по условиям "$Условия$"
Тогда для каждого элемента "СтрокаОстатка" результата запроса
  И Я запоминаю значение выражения 'Контекст.СтрокаОстатка.Регистратор.id' в переменную "Идентификатор"
  И Я удаляю запись "Документ.ЧекККМ.$Идентификатор$" внешней системы "RAT_REST"
```

### Срезы регистров сведений

#### Шаг: И Я получаю срез последних "РегистрСведений.НастройкиУчета" внешней системы "RAT_REST" по условиям

Выполняет запрос на получение среза последних по регистру по заданным условиям.
Получает наиболее поздние записи регистра, соответствующие установленным в параметрах метода значениям ключевых полей.
Записи подбираются для каждого сочетания из всех имеющихся значений измерений регистра.

Метод: `ЯПолучаюСрезПоследнихВнешнейСистемыПоУсловиям(ИмяТаблицы, ИмяНастройки, Условия)`

Результат: Массив записей среза.
Каждая запись содержит значения измерений, период и самые поздние значения ресурсов

Параметры

| Параметр     | Описание                                                                                       |
|--------------|------------------------------------------------------------------------------------------------|
| ИмяТаблицы   | Имя таблицы информационной базы 1С, например `РегистрСведений.АудиторскийСлед`                 |
| ИмяНастройки | Имя настроенного источника данных                                                              |
| Условия      | Таблица условий (первая колонка - имя реквизита, вторая - значение) или переменная с условиями |

Примеры

```gherkin
Когда Я получаю срез последних "РегистрСведений.АудиторскийСлед" внешней системы "RAT_REST" по условиям
  | Объект      | Справочник.Пользователи.$Идентификатор$ |
```

```gherkin
Дано Я создаю структуру "Условия"
  | Объект      | Справочник.Пользователи.$Идентификатор$ |
Когда Я получаю срез последних "РегистрСведений.АудиторскийСлед" внешней системы "RAT_REST" по условиям "$Условия$"
Тогда реквизит результата запроса "[0].Пользователь.id" равен "$Идентификатор$"
```

#### Шаг: И Я получаю срез первых "РегистрСведений.НастройкиУчета" внешней системы "RAT_REST" по условиям

Выполняет запрос на получение среза первых по регистру по заданным условиям.
Получает наиболее ранние записи регистра, соответствующие установленным в параметрах метода значениям ключевых полей.
Записи подбираются для каждого сочетания из всех имеющихся значений измерений регистра.

Метод: `ЯПолучаюСрезПервыхВнешнейСистемыПоУсловиям(ИмяТаблицы, ИмяНастройки, Условия)`

Результат: Массив записей среза.
Каждая запись содержит значения измерений, период и самые ранние значения ресурсов

Параметры

| Параметр     | Описание                                                                                       |
|--------------|------------------------------------------------------------------------------------------------|
| ИмяТаблицы   | Имя таблицы информационной базы 1С, например `РегистрСведений.АудиторскийСлед`                 |
| ИмяНастройки | Имя настроенного источника данных                                                              |
| Условия      | Таблица условий (первая колонка - имя реквизита, вторая - значение) или переменная с условиями |

Примеры

```gherkin
Когда Я получаю срез первых "РегистрСведений.АудиторскийСлед" внешней системы "RAT_REST" по условиям
  | Объект      | Справочник.Пользователи.$Идентификатор$ |
```

```gherkin
Дано Я создаю структуру "Условия"
  | Объект      | Справочник.Пользователи.$Идентификатор$ |
Когда Я получаю срез первых "РегистрСведений.АудиторскийСлед" внешней системы "RAT_REST" по условиям "$Условия$"
Тогда реквизит результата запроса "[0].Пользователь.id" равен "$Идентификатор$"
```

### Регламентные задания

#### Шаг: И Я запускаю регламентное задание "Представление регламентного задания" внешней системы "RAT_REST"

Метод: `ЯЗапускаюРегламентноеЗаданиеВнешнейСистемы(ИдентификаторЗадания, ИмяНастройки)`

Выполняет запуск регламентного задания во внешней системе

Параметры

| Параметр             | Описание                            | Примеры                                                                                                                 |
|----------------------|-------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗадания | Идентификатор регламентного задания | a772d037-9519-4c2b-8c9b-ad9de187fe90, Представление регламентного задания, Метаданные=ИмяРегламентногоЗадания |
| ИмяНастройки         | Имя настроенного источника данных   |                                                                                                                         |

В качестве идентификатора задания может выступать:

* УникальныйИдентификатор
* Наименование
* Составной ключ, содержащий поля фильтрации
    | Поле фильтрации         | Тип    | Описание                                                                                                                      |
    |-------------------------|--------|-------------------------------------------------------------------------------------------------------------------------------|
    | Наименование            | Строка | Наименование регламентного задания                                                                                            |
    | УникальныйИдентификатор | Строка | Уникальные идентификатор регламентного задания                                                                                |
    | Ключ                    | Строка | Ключ регламентного задания                                                                                                    |
    | Метаданные              | Строка | Имя метаданных регламентного задания                                                                                          |
    | Предопределенное        | Булево | Указывает, является ли регламентное задание предопределенным. Предопределенные регламентные задания определяются в метаданных |
    | Использование           | Булево | Признак использования регламентного задания                                                                                   |

Примеры

```gherkin
# Запуск регламентного задания по наименованию (наименование должно быть уникальным)
И Я запускаю регламентное задание "Представление регламентного задания" внешней системы "RAT_REST"
# Запуск регламентного задания по уникальному идентификатору
И Я запускаю регламентное задание "a772d037-9519-4c2b-8c9b-ad9de187fe90" внешней системы "RAT_REST"
# Запуск регламентного задания по структуре отборе
И Я запускаю регламентное задание "Метаданные=ИмяРегламентногоЗадания;Использование=Истина" внешней системы "RAT_REST"
```

#### Шаг: И Я запускаю регламентное задание "Представление регламентного задания" внешней системы "RAT_REST" и ожидаю завершения

Метод: `ЯЗапускаюРегламентноеЗаданиеВнешнейСистемыИОжидаюЗавершения(ИдентификаторЗадания, ИмяНастройки)`

Выполняет запуск и ожидает завершения регламентного задания во внешней системе

Описание параметров и примеры смотрите в шаге [И Я запускаю регламентное задание "Представление регламентного задания" внешней системы "RAT_REST"](#шаг-и-я-запускаю-регламентное-задание-представление-регламентного-задания-внешней-системы-rat_rest)

#### Шаг: Дано Я останавливаю регламентное задание "Представление регламентного задания" внешней системы "RAT_REST"

Метод: `ЯОстанавливаюРегламентноеЗаданиеВнешнейСистемы(ИдентификаторЗадания, ИмяНастройки)`

Останавливается выполнение активного фонового задания

Параметры

| Параметр             | Описание                            | Примеры                                                                                                                 |
|----------------------|-------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗадания | Идентификатор регламентного задания | a772d037-9519-4c2b-8c9b-ad9de187fe90, Представление регламентного задания, Метаданные=ИмяРегламентногоЗадания |
| ИмяНастройки         | Имя настроенного источника данных   |                                                                                                                         |

#### Шаг: И Я ожидаю завершения регламентного задания "Представление регламентного задания" внешней системы "RAT_REST"

Метод: `ЯОжидаюЗавершенияРегламентногоЗаданияВнешнейСистемы(ИдентификаторЗадания, ИмяНастройки)`

Останавливает выполнения сценария и ждет окончания выполнения

Параметры

| Параметр             | Описание                            | Примеры                                                                                                                 |
|----------------------|-------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗадания | Идентификатор регламентного задания | a772d037-9519-4c2b-8c9b-ad9de187fe90, Представление регламентного задания, Метаданные=ИмяРегламентногоЗадания |
| ИмяНастройки         | Имя настроенного источника данных   |                                                                                                                         |

В качестве идентификатора задания может выступать:

* УникальныйИдентификатор
* Наименование
* Составной ключ, содержащий поля фильтрации
    | Поле фильтрации         | Тип    | Описание                                                                                                                      |
    |-------------------------|--------|-------------------------------------------------------------------------------------------------------------------------------|
    | Наименование            | Строка | Наименование регламентного задания                                                                                            |
    | УникальныйИдентификатор | Строка | Уникальные идентификатор регламентного задания                                                                                |
    | Ключ                    | Строка | Ключ регламентного задания                                                                                                    |
    | Метаданные              | Строка | Имя метаданных регламентного задания                                                                                          |
    | Предопределенное        | Булево | Указывает, является ли регламентное задание предопределенным. Предопределенные регламентные задания определяются в метаданных |
    | Использование           | Булево | Признак использования регламентного задания                                                                                   |

Примеры

```gherkin
# Ожидание выполнения регламентного задания по наименованию (наименование должно быть уникальным)
И Я ожидаю завершения регламентного задания "Представление регламентного задания" внешней системы "RAT_REST"
# Ожидание выполнения регламентного задания по уникальному идентификатору
И Я ожидаю завершения регламентного задания "a772d037-9519-4c2b-8c9b-ad9de187fe90" внешней системы "RAT_REST"
# Ожидание выполнения регламентного задания по структуре отборе
И Я ожидаю завершения регламентного задания "Метаданные=ИмяРегламентногоЗадания;Использование=Истина" внешней системы "RAT_REST"
```

#### Шаг: Дано Я устанавливаю максимальное время ожидания завершения регламентного задания "10 минут"

Метод: `ЯУстанавливаюМаксимальноеВремяОжиданияЗавершенияРегламентногоЗадания(ВремяОжидания)`

Устанавливает максимальное время ожидания завершения регламентного задания. По умолчанию время ожидания - 5 минут

По окончании этого времени, если задание не завершилось, будет выброшено исключение.

Параметры

| Параметр      | По умолчанию | Примеры                                                |
|---------------|--------------|--------------------------------------------------------|
| ВремяОжидания | 5 минут      | 5 минут, 30 секунд, 2 часа, 1 минута, 0 - без ожидания |

#### Шаг: И Я перезапускаю регламентное задание "Представление регламентного задания" внешней системы "RAT_REST"

Метод: `ЯПерезапускаюРегламентноеЗаданиеВнешнейСистемы(ИдентификаторЗадания, ИмяНастройки)`

Останавливает и вновь запускает регламентное задание

Параметры

| Параметр             | Описание                            | Примеры                                                                                                                 |
|----------------------|-------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗадания | Идентификатор регламентного задания | a772d037-9519-4c2b-8c9b-ad9de187fe90, Представление регламентного задания, Метаданные=ИмяРегламентногоЗадания |
| ИмяНастройки         | Имя настроенного источника данных   |                                                                                                                         |

В качестве идентификатора задания может выступать:

* УникальныйИдентификатор
* Наименование
* Составной ключ, содержащий поля фильтрации
    | Поле фильтрации         | Тип    | Описание                                                                                                                      |
    |-------------------------|--------|-------------------------------------------------------------------------------------------------------------------------------|
    | Наименование            | Строка | Наименование регламентного задания                                                                                            |
    | УникальныйИдентификатор | Строка | Уникальные идентификатор регламентного задания                                                                                |
    | Ключ                    | Строка | Ключ регламентного задания                                                                                                    |
    | Метаданные              | Строка | Имя метаданных регламентного задания                                                                                          |
    | Предопределенное        | Булево | Указывает, является ли регламентное задание предопределенным. Предопределенные регламентные задания определяются в метаданных |
    | Использование           | Булево | Признак использования регламентного задания                                                                                   |

Примеры

```gherkin
# Перезапуск регламентного задания по наименованию (наименование должно быть уникальным)
И Я перезапускаю регламентного задания "Представление регламентного задания" внешней системы "RAT_REST"
# Перезапуск регламентного задания по уникальному идентификатору
И Я перезапускаю регламентного задания "a772d037-9519-4c2b-8c9b-ad9de187fe90" внешней системы "RAT_REST"
# Перезапуск регламентного задания по структуре отборе
И Я перезапускаю регламентного задания "Метаданные=ИмяРегламентногоЗадания;Использование=Истина" внешней системы "RAT_REST"
```

#### Шаг: И Я перезапускаю регламентное задание "Представление регламентного задания" внешней системы "RAT_REST" и ожидаю завершения

Метод: `ЯПерезапускаюРегламентноеЗаданиеВнешнейСистемыИОжидаюЗавершения(ИдентификаторЗадания, ИмяНастройки)`

Останавливает, вновь запускает и ожидает завершения регламентного задания во внешней системе

Параметры

| Параметр             | Описание                            | Примеры                                                                                                                 |
|----------------------|-------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗадания | Идентификатор регламентного задания | a772d037-9519-4c2b-8c9b-ad9de187fe90, Представление регламентного задания, Метаданные=ИмяРегламентногоЗадания |
| ИмяНастройки         | Имя настроенного источника данных   |                                                                                                                         |

#### Шаг: Дано Я включаю регламентное задание "Представление регламентного задания" внешней системы "RAT_REST"

Метод: `ЯВключаюРегламентноеЗаданиеВнешнейСистемы(ИдентификаторЗадания, ИмяНастройки)`

Включает выполнение регламентного задания по настроенному расписанию (не запускает).

Параметры

| Параметр             | Описание                            | Примеры                                                                                                                 |
|----------------------|-------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗадания | Идентификатор регламентного задания | a772d037-9519-4c2b-8c9b-ad9de187fe90, Представление регламентного задания, Метаданные=ИмяРегламентногоЗадания |
| ИмяНастройки         | Имя настроенного источника данных   |                                                                                                                         |

#### Шаг: Дано Я выключаю регламентное задание "Представление регламентного задания" внешней системы "RAT_REST"

Метод: `ЯВыключаюРегламентноеЗаданиеВнешнейСистемы(ИдентификаторЗадания, ИмяНастройки)`

Выключает выполнение регламентного задания по расписанию. Не останавливает выполнение исполняющегося в данный момент фонового задания.

Параметры

| Параметр             | Описание                            | Примеры                                                                                                                 |
|----------------------|-------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗадания | Идентификатор регламентного задания | a772d037-9519-4c2b-8c9b-ad9de187fe90, Представление регламентного задания, Метаданные=ИмяРегламентногоЗадания |
| ИмяНастройки         | Имя настроенного источника данных   |                                                                                                                         |

#### Шаг: Дано Я включаю все регламентные задания внешней системы "RAT_REST"

Метод: `ЯВключаюВсеРегламентныеЗаданияВнешнейСистемы(ИмяНастройки)`

Включает выполнение всех регламентных заданий по настроенному расписанию (не запускает).

Параметры

| Параметр     | Описание                          |
|--------------|-----------------------------------|
| ИмяНастройки | Имя настроенного источника данных |

#### Шаг: Дано Я выключаю все регламентные задания внешней системы "RAT_REST"

Метод: `ЯВыключаюВсеРегламентныеЗаданияВнешнейСистемы(ИмяНастройки)`

Выключает запуск по расписанию всех регламентных заданий. Не останавливает выполнение исполняющихся в данный момент фоновых заданий.

Параметры

| Параметр     | Описание                          |
|--------------|-----------------------------------|
| ИмяНастройки | Имя настроенного источника данных |

#### Шаг: Дано Я получаю параметры регламентного задания "Представление регламентного задания" внешней системы "RAT_REST"

Метод: `ЯПолучаюПараметрыРегламентногоЗаданияВнешнейСистемы(ИдентификаторЗадания, ИмяНастройки)`

Получает информацию о параметрах регламентного задания.

* Включенность
* Расписание
* Данные об активном фоновом задание и тд

После с полученными данными можно работать через шаги раздела "Обработка ответов"

Параметры

| Параметр             | Описание                            | Примеры                                                                                                                 |
|----------------------|-------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| ИдентификаторЗадания | Идентификатор регламентного задания | a772d037-9519-4c2b-8c9b-ad9de187fe90, Представление регламентного задания, Метаданные=ИмяРегламентногоЗадания |
| ИмяНастройки         | Имя настроенного источника данных   |                                                                                                                         |

### Регистрация изменений

#### Шаг: И я регистрирую изменение "Справочник.Банки.$ИмяОбъекта$" на узле "ПланОбмена.ТрансляцияИзменений.$ИмяУзла$" внешней системы "RAT_REST"

Метод: `ЯРегистрируюИзменениеНаУзлеВнешнейСистемы(ИдентификаторОбъекта, ИдентификаторУзла, ИмяНастройки)`

Регистрирует изменение указанного объекта на узле плана обмена.

Параметры

| Параметр             | Описание                                                            | Примеры                               |
|----------------------|---------------------------------------------------------------------|---------------------------------------|
| ИдентификаторОбъекта | Идентификатор регистрируемого объекта                               | `Справочник.Банки.Сбербанк`           |
| ИдентификаторУзла    | Идентификатор узла обмена, на котором нужно зарегистрировать объект | `ПланОбмена.ТрансляцияИзменений.Офис` |
| ИмяНастройки         | Имя настроенного источника данных                                   | `RAT_REST`                            |

Примеры

```gherkin
И я регистрирую изменение "Справочник.Банки.$ИмяОбъекта$" на узле "ПланОбмена.ТрансляцияИзменений.$ИмяУзла$" внешней системы "RAT_REST"
```

#### Шаг: я удаляю регистрацию изменений "Справочник.Банки.$ИмяОбъекта$" на узле "ПланОбмена.ТрансляцияИзменений.$ИмяУзла$" внешней системы "RAT_REST"

Метод: `ЯУдаляюРегистрациюИзмененийНаУзлеВнешнейСистемы(ИдентификаторОбъекта, ИдентификаторУзла, ИмяНастройки)`

Удаляет регистрацию изменений указанного объекта на узле плана обмена.

Параметры

| Параметр             | Описание                                                      | Примеры                                                       |
|----------------------|---------------------------------------------------------------|---------------------------------------------------------------|
| ИдентификаторОбъекта | Идентификатор объекта, который необходимо снять с регистрации | `All`, `Все`, `Справочник.Банки`, `Справочник.Банки.Сбербанк` |
| ИдентификаторУзла    | Идентификатор узла обмена                                     | `ПланОбмена.ТрансляцияИзменений.Офис`                         |
| ИмяНастройки         | Имя настроенного источника данных                             | `RAT_REST`                                                    |

В качестве `ИдентификаторОбъекта` можно указывать:

* Ссылку на конкретный объект - `Справочник.Банки.Сбербанк`.
* Имя объекта метаданных, все объекты этого типа будут удалены с регистрации, `Справочник.Банки`.
* Для удаления всех зарегистрированных объектов нужно указать `All` или `Все`.
* Также можно указывать массив значений, из объектов указанных выше, `[Справочник.Банки, Документ.ПКО]`, `[Справочник.Банки.Сбербанк, Документ.ПКО.0000001]`, `[Справочник.Банки.Сбербанк, Документ.ПКО]`

Примеры

```gherkin
Тогда я удаляю регистрацию изменений "Справочник.Банки.$ИмяОбъекта$" на узле "ПланОбмена.ТрансляцияИзменений.$ИмяУзла$" внешней системы "RAT_REST"
```

#### Шаг: Тогда объект "Справочник.Банки.$ИмяОбъекта$" зарегистрирован на узле "ПланОбмена.ТрансляцияИзменений.$ИмяУзла$" внешней системы "RAT_REST"

Метод: `ОбъектЗарегистрированНаУзлеВнешнейСистемы(ИдентификаторОбъекта, ИдентификаторУзла, ИмяНастройки)`

Проверяет наличие регистрации изменений указанного объекта на узле плана обмена.

Параметры

| Параметр             | Описание                                  | Примеры                             |
|----------------------|-------------------------------------------|-------------------------------------|
| ИдентификаторОбъекта | Идентификатор зарегистрированного объекта | Справочник.Банки.Сбербанк           |
| ИдентификаторУзла    | Идентификатор узла обмена                 | ПланОбмена.ТрансляцияИзменений.Офис |
| ИмяНастройки         | Имя настроенного источника данных         | RAT_REST                            |

Примеры

```gherkin
Когда я регистрирую изменение "Справочник.Банки.$ИмяОбъекта$" на узле "ПланОбмена.ТрансляцияИзменений.$ИмяУзла$" внешней системы "RAT_REST"
Тогда Объект "Справочник.Банки.$ИмяОбъекта$" зарегистрирован на узле "ПланОбмена.ТрансляцияИзменений.$ИмяУзла$" внешней системы "RAT_REST"
```

#### Шаг: Тогда Объект "Справочник.Банки.$ИмяОбъекта$" не зарегистрирован на узле "ПланОбмена.ТрансляцияИзменений.$ИмяУзла$" внешней системы "RAT_REST"

Метод: `ОбъектНеЗарегистрированНаУзлеВнешнейСистемы(ИдентификаторОбъекта, ИдентификаторУзла, ИмяНастройки)`

Проверяет отсутствие регистрации изменений указанного объекта на узле плана обмена.

Параметры

| Параметр             | Описание                                  | Примеры                             |
|----------------------|-------------------------------------------|-------------------------------------|
| ИдентификаторОбъекта | Идентификатор зарегистрированного объекта | Справочник.Банки.Сбербанк           |
| ИдентификаторУзла    | Идентификатор узла обмена                 | ПланОбмена.ТрансляцияИзменений.Офис |
| ИмяНастройки         | Имя настроенного источника данных         | RAT_REST                            |

Примеры

```gherkin
Когда я удаляю регистрацию изменений "Справочник.Банки.$ИмяОбъекта$" на узле "ПланОбмена.ТрансляцияИзменений.$ИмяУзла$" внешней системы "RAT_REST"
Тогда объект "Справочник.Банки.$ИмяОбъекта$" не зарегистрирован на узле "ПланОбмена.ТрансляцияИзменений.$ИмяУзла$" внешней системы "RAT_REST"
```

### Пользователи информационной базы

#### Шаг: И Я получаю данные пользователя "ИмяПользователя" внешней системы "RAT_REST"

Метод: `ЯПолучаюДанныеПользователяВнешнейСистемы(ИмяПользователя, ИмяНастройки)`

Получает и запоминает информацию о пользователе информационной базы.
После с полученными данными можно работать через шаги раздела "Обработка ответов"

Параметры

| Параметр        | Описание                             | Примеры        |
|-----------------|--------------------------------------|----------------|
| ИмяПользователя | Имя пользователя информационной базы | ИмяПользователя |
| ИмяНастройки    | Имя настроенного источника данных    | RAT_REST       |

Информация по пользователе содержит:

| Реквизит                  | Описание                                                                                                    |
|---------------------------|-------------------------------------------------------------------------------------------------------------|
| УникальныйИдентификатор   | Уникальный идентификатор пользователя информационной базы                                                   |
| Имя                       | Имя пользователя информационной базы                                                                        |
| ПолноеИмя                 | Полное имя пользователя информационной базы                                                                 |
| АутентификацияСтандартная | Определяет использование стандартной аутентификации (пользователь-пароль)                                   |
| АутентификацияOpenID      | Указывает, разрешена ли пользователю аутентификация по протоколу OpenID                                     |
| ПоказыватьВСпискеВыбора   | Определяет, показывать ли данного пользователя в списке для выбора при старте системы                       |
| АутентификацияОС          | Определяет, использовать ли аутентификацию Windows для данного пользователя                                 |
| ПользовательОС            | Содержит строку, идентифицирующую пользователя операционной системы в формате `\\ИмяДомена\ИмяПользователя` |
| ОсновнойИнтерфейс         | Основной интерфейс пользователя                                                                             |
| Язык                      | Язык пользователя информационной базы                                                                       |
| ПарольУстановлен          | Показывает, установлен ли пароль у пользователя                                                             |
| ЗапрещеноИзменятьПароль   | Определяет возможность пользователя изменять свой пароль                                                    |
| РежимЗапуска              | Режим запуска клиентского приложения                                                                        |
| ЗащитаОтОпасныхДействий   | Защита от опасных действий                                                                                  |
| РазделениеДанных          | Содержит установленные пользователю значения разделителей                                                   |
| Роли                      | Коллекция (массив) ролей пользователя информационной базы                                                   |

Примеры

```gherkin
Когда Я получаю данные пользователя "ИмяПользователя" внешней системы "RAT_REST"
Тогда реквизит результата запроса "Имя" равен "ИмяПользователя"
```

#### Шаг: И Я создаю пользователя внешней системы "RAT_REST"

Метод: `ЯСоздаюПользователяВнешнейСистемы(ИмяНастройки, Данные)`

Получает и запоминает информацию о пользователе информационной базы.
После с полученными данными можно работать через шаги раздела "Обработка ответов"

Параметры

| Параметр     | Описание                          |
|--------------|-----------------------------------|
| ИмяНастройки | Имя настроенного источника данных |
| Данные       | Данные создаваемого пользователя  |

Структура данных пользователя:

| Реквизит                  | Пример                      | Описание                                                                                                                        |
|---------------------------|-----------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| Имя                       | ИмяПользователя              | Имя пользователя информационной базы                                                                                            |
| ПолноеИмя                 | ИмяПользователя              | Полное имя пользователя информационной базы                                                                                     |
| АутентификацияСтандартная | true                        | Определяет использование стандартной аутентификации (пользователь-пароль)                                                       |
| АутентификацияOpenID      |                             | Указывает, разрешена ли пользователю аутентификация по протоколу OpenID                                                         |
| ПоказыватьВСпискеВыбора   | true                        | Определяет, показывать ли данного пользователя в списке для выбора при старте системы                                           |
| Пароль                    | 123                         | Пароль, используемый при стандартной аутентификации                                                                             |
| СохраняемоеЗначениеПароля |                             | Содержит хранимые значения пароля (хеш-функции) и хранимые значения пароля в верхнем регистре (хеш-функции) разделенные запятой |
| АутентификацияОС          |                             | Определяет, использовать ли аутентификацию Windows для данного пользователя                                                     |
| ПользовательОС            |                             | Содержит строку, идентифицирующую пользователя операционной системы в формате `\\ИмяДомена\ИмяПользователя`                     |
| ОсновнойИнтерфейс         |                             | Основной интерфейс пользователя                                                                                                 |
| Язык                      |                             | Язык пользователя информационной базы                                                                                           |
| ЗапрещеноИзменятьПароль   | true                        | Определяет возможность пользователя изменять свой пароль                                                                        |
| РежимЗапуска              |                             | Режим запуска клиентского приложения                                                                                            |
| ЗащитаОтОпасныхДействий   |                             | Защита от опасных действий                                                                                                      |
| РазделениеДанных          |                             | Содержит установленные пользователю значения разделителей                                                                       |
| Роли                      | Пользователь, ПолныеПрава | Коллекция (массив) ролей пользователя информационной базы, разделенных запятой или точкой с запятой                             |

Примеры

```gherkin
Когда Я создаю пользователя внешней системы "RAT_REST"
| Имя    | Новый пользователь         |
| Пароль | 123                        |
| Роли   | Пользователь, ПолныеПрава |
Тогда существует пользователь" Новый пользователь" внешней системы "RAT_REST"
```

#### Шаг: И Я изменяю пользователя "ИмяПользователя" внешней системы "RAT_REST"

Метод: `ЯИзменяюПользователяВнешнейСистемы(ИмяНастройки, Данные)`

Изменяет существующего пользователя информационной базы.

Параметры

| Параметр        | Описание                          |
|-----------------|-----------------------------------|
| ИмяПользователя | Имя изменяемого пользователя      |
| ИмяНастройки    | Имя настроенного источника данных |
| Данные          | Данные создаваемого пользователя  |

Структура данных пользователя:

| Реквизит                  | Пример                      | Описание                                                                                                                        |
|---------------------------|-----------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| Имя                       | ИмяПользователя              | Имя пользователя информационной базы                                                                                            |
| ПолноеИмя                 | ИмяПользователя              | Полное имя пользователя информационной базы                                                                                     |
| АутентификацияСтандартная | true                        | Определяет использование стандартной аутентификации (пользователь-пароль)                                                       |
| АутентификацияOpenID      |                             | Указывает, разрешена ли пользователю аутентификация по протоколу OpenID                                                         |
| ПоказыватьВСпискеВыбора   | true                        | Определяет, показывать ли данного пользователя в списке для выбора при старте системы                                           |
| Пароль                    | 123                         | Пароль, используемый при стандартной аутентификации                                                                             |
| СохраняемоеЗначениеПароля |                             | Содержит хранимые значения пароля (хеш-функции) и хранимые значения пароля в верхнем регистре (хеш-функции) разделенные запятой |
| АутентификацияОС          |                             | Определяет, использовать ли аутентификацию Windows для данного пользователя                                                     |
| ПользовательОС            |                             | Содержит строку, идентифицирующую пользователя операционной системы в формате `\\ИмяДомена\ИмяПользователя`                     |
| ОсновнойИнтерфейс         |                             | Основной интерфейс пользователя                                                                                                 |
| Язык                      |                             | Язык пользователя информационной базы                                                                                           |
| ЗапрещеноИзменятьПароль   | true                        | Определяет возможность пользователя изменять свой пароль                                                                        |
| РежимЗапуска              |                             | Режим запуска клиентского приложения                                                                                            |
| ЗащитаОтОпасныхДействий   |                             | Защита от опасных действий                                                                                                      |
| РазделениеДанных          |                             | Содержит установленные пользователю значения разделителей                                                                       |
| Роли                      | Пользователь, ПолныеПрава | Коллекция (массив) ролей пользователя информационной базы, разделенных запятой или точкой с запятой                             |

Примеры

```gherkin
Когда Я изменяю пользователя "ИмяПользователя" внешней системы "RAT_REST"
| Пароль | 123                         |
| Роли   | Пользователь, ПолныеПрава |
```

#### Шаг: Если существует пользователь"ИмяПользователя" внешней системы "RAT_REST"

Метод: `СуществуетПользовательВнешнейСистемы(ИмяПользователя, ИмяНастройки)`

Проверяет существование пользователя в информационной базе.
Шаг можно использовать в условиях `Если`
Параметры

| Параметр        | Описание                             | Примеры        |
|-----------------|--------------------------------------|----------------|
| ИмяПользователя | Имя пользователя информационной базы | ИмяПользователя |
| ИмяНастройки    | Имя настроенного источника данных    | RAT_REST       |

Примеры

```gherkin
Дано существует пользователь"ИмяПользователя" внешней системы "RAT_REST"
И Я запускаю клиент тестирования
Если существует пользователь"ИмяПользователя" внешней системы "RAT_REST" Тогда
  Тогда реквизит результата запроса "Имя" равен "ИмяПользователя"
```

#### Шаг: Если не существует пользователь"ИмяПользователя" внешней системы "RAT_REST"

Метод: `НеСуществуетПользовательВнешнейСистемы(ИмяПользователя, ИмяНастройки)`

Проверяет отсутствие пользователя в информационной базе.
Шаг можно использовать в условиях `Если`
Параметры

| Параметр        | Описание                             | Примеры        |
|-----------------|--------------------------------------|----------------|
| ИмяПользователя | Имя пользователя информационной базы | ИмяПользователя |
| ИмяНастройки    | Имя настроенного источника данных    | RAT_REST       |

Примеры

```gherkin
Если не существует пользователь"Новый пользователь" внешней системы "RAT_REST" Тогда
  Тогда Я создаю пользователя внешней системы "RAT_REST"
    | Имя    | Новый пользователь         |
    | Пароль | 123                        |
    | Роли   | Пользователь, ПолныеПрава  |
```

## Выполнение произвольных запросов к 1с

### Шаг: И я выполняю алгоритм во внешней системе "RAT_REST"

Метод: `ЯВыполняюАлгоритмВоВнешнейСистеме(ИмяНастройки, ТекстАлгоритма)`

Выполняет произвольный алгоритм во внешней системе.

Параметры

| Параметр       | Описание                                      | Примеры                   |
| -------------- | --------------------------------------------- | ------------------------- |
| ИмяНастройки   | Имя настроенного источника данных             | RAT_REST                  |
| ТекстАлгоритма | Произвольные алгоритм на языке 1С:Предприятия | Сообщить("Привет, мир!"); |

Примеры

```gherkin
И я выполняю алгоритм во внешней системе "RAT_REST"
  """
  Сообщить("Привет, мир!");
  """
```

### Шаг: И я выполняю алгоритм с параметрами "$Параметры$" во внешней системе "RAT_REST"

Метод: `ЯВыполняюАлгоритмСПараметрамиВоВнешнейСистеме(Параметры, ИмяНастройки, ТекстАлгоритма)`

Выполняет произвольный алгоритм во внешней системе.

Параметры

| Параметр       | Описание                                      | Примеры                   |
| -------------- | --------------------------------------------- | ------------------------- |
| Параметры      | Имя настроенного источника данных             | RAT_REST                  |
| ИмяНастройки   | Имя настроенного источника данных             | RAT_REST                  |
| ТекстАлгоритма | Произвольные алгоритм на языке 1С:Предприятия | Сообщить("Привет, мир!"); |

Примеры

Вызов алгоритма с параметрами

```gherkin
И Я создаю структуру "Параметры"
  | Дата    | $ДатаДокумента$  |
  | Номер   | $НомерДокумента$ |
  | Товар   | $Товар$          |
  
И я выполняю алгоритм с параметрами "$Параметры$" во внешней системе "RAT_REST"
  """
  Документ = ВыполнитьПоискДокумента(Параметры.Дата, Параметры.Номер);
  Объект = Документ.ПолучитьОбъект();
  Объект.Записать(РежимЗаписиДокумента.Проведение);
  """
```

Типизированные параметры алгоритма

```gherkin
И Я создаю типизированную структуру "Параметры"
  | Дата    | $ДатаДокумента$  | dateTime                |
  | Номер   | $НомерДокумента$ |                         |
  | Товар   | $Товар$          | CatalogRef.Номенклатура |
  
И я выполняю алгоритм с параметрами "$Параметры$" во внешней системе "RAT_REST"
  """
  Документ = ВыполнитьПоискДокумента(Параметры.Дата, Параметры.Номер);
  Объект = Документ.ПолучитьОбъект();
  Объект.Товар = Параметры.Товар;
  Объект.Записать();
  """
```

## Обработка ответов

### Шаг: И Я сохраняю в переменную "post_id" реквизит результата запроса "[0].id"

Метод: `ЯСохраняюВПеременнуюРеквизитРезультатаЗапроса(ИмяПеременной, ПутьКРеквизиту)`

Извлекает данные из ответа на последний запрос (при условии если ответ в JSON).

`ПутьКРеквизиту` - путь от корневого элемента до нужного реквизита.

* Для обращения к реквизиту элемента - указываем после точки имя реквизита, например `user.id`
* Для обращения к элементу коллекции - указываем индекс элемента в квадратных скобках (нумерация индекса начинается с 0), например `users[2].id`
  
  Для обращения к последним элементам используйте минус, например:
  * `users[-1].id` - id последнего пользователя
  * `users[-2].id` - id предпоследнего пользователя

Предположим имеем такой ответ

```json
{
"page_info": {
  "total_results": 4930,
  "results_per_page": 10,
  "current_page": 1
},
"kind": "ShippingCollection",
"items": [
  {
    "kind": "Shipping",
    "id": "1",
    "assigned_resources": [
      {
        "driver_contact_info": "+79000000000",
        "route_segment_id": 1,
        "drivers_ids": [
          "1", "2"
        ],
        "car_id": "3",
        "trailer_id": "d"
      }
    ]
  }
]}
```

Примеры

* `items[0].id` - получаем ID первого элемента
* `page_info.total_results` - общее количество ресурсов
* `items[0].assigned_resources[0].drivers_ids[1]` - идентификатор второго водителя

### Шаг: И Я сохраняю в переменную "ЗначениеКонстанты" реквизит результата запроса "Объект" с типом "Дата"

Метод: `ЯСохраняюВПеременнуюРеквизитРезультатаЗапросаСТипом(ИмяПеременной, ПутьКРеквизиту, ИмяТипа)`

Извлекает данные из ответа на последний запрос (при условии если ответ в JSON) и приводит извлеченное значение к указанному типу.

`ПутьКРеквизиту` - путь от корневого элемента до нужного реквизита.

* Для обращения к реквизиту элемента - указываем после точки имя реквизита, например `user.id`
* Для обращения к элементу коллекции - указываем индекс элемента в квадратных скобках (нумерация индекса начинается с 0), например `users[2].id`
  
  Для обращения к последним элементам используйте минус, например:
  * `users[-1].id` - id последнего пользователя
  * `users[-2].id` - id предпоследнего пользователя

`ИмяТипа` - Имя типа переменной, XML тип или имя объекта метаданных.

Примеры XML типов:

| Тип                    | XML тип                |
|------------------------|------------------------|
| Число                  | decimal                |
| Булево                 | boolean                |
| Дата                   | dateTime               |
| Null                   | Null                   |
| ВидДвиженияБухгалтерии | AccountingRecordType   |
| ВидДвиженияНакопления  | AccumulationRecordType |
| Строка                 | string                 |

### Шаг: И реквизит результата запроса "body" равен "Это тестовый пост"

Метод: `РеквизитРезультатаЗапросаРавен(ПутьКРеквизиту, ЭталонноеЗначение)`

Сравнивает значение реквизита извлеченное из тела ответа с эталонным значением.
Сравнение происходит по значению и текстовому представлению.

* Числа указываются без пробелов, десятичные отделяются точной
* Дата указывается в формате ISO 8601 (гггг-ММ-ддTЧЧ:мм:сс)
* Булево - true/false

`ПутьКРеквизиту` - путь от корневого элемента до нужного реквизита.

* Для обращения к реквизиту элемента - указываем после точки имя реквизита, например `user.id`
* Для обращения к элементу коллекции - указываем индекс элемента в квадратных скобках (нумерация индекса начинается с 0), например `users[2].id`
  
  Для обращения к последним элементам используйте минус, например:
  * `users[-1].id` - id последнего пользователя
  * `users[-2].id` - id предпоследнего пользователя

Предположим имеем такой ответ

```json
{
"page_info": {
  "total_results": 4930,
  "results_per_page": 10,
  "current_page": 1
},
"kind": "ShippingCollection",
"items": [
  {
    "kind": "Shipping",
    "id": "1",
    "assigned_resources": [
      {
        "driver_contact_info": "+79000000000",
        "route_segment_id": 1,
        "drivers_ids": [
          "1", "2"
        ],
        "car_id": "3",
        "trailer_id": "d"
      }
    ]
  }
]}
```

Примеры

* `items[0].id` - получаем ID первого элемента
* `page_info.total_results` - общее количество ресурсов
* `items[0].assigned_resources[0].drivers_ids[1]` - идентификатор второго водителя

### Шаг: И реквизит результата запроса "body" не равен "Это тестовый пост"

Метод: `РеквизитРезультатаЗапросаНеРавен(ПутьКРеквизиту, ЭталонноеЗначение)`

Сравнивает значение реквизита извлеченное из тела ответа с эталонным значением.
Сравнение происходит по значению и текстовому представлению.

* Числа указываются без пробелов, десятичные отделяются точной
* Дата указывается в формате ISO 8601 (гггг-ММ-ддTЧЧ:мм:сс)
* Булево - true/false

`ПутьКРеквизиту` - путь от корневого элемента до нужного реквизита.

* Для обращения к реквизиту элемента - указываем после точки имя реквизита, например `user.id`
* Для обращения к элементу коллекции - указываем индекс элемента в квадратных скобках (нумерация индекса начинается с 0), например `users[2].id`
  
  Для обращения к последним элементам используйте минус, например:
  * `users[-1].id` - id последнего пользователя
  * `users[-2].id` - id предпоследнего пользователя

Примеры

```gherkin
И реквизит результата запроса "body" не равен "Это тестовый пост"
```

### Шаг: И реквизит результата запроса "body" соответствует шаблону "Это тестовый пост"

Метод: `РеквизитРезультатаЗапросаСоответствуетШаблону(ПутьКРеквизиту, Шаблон)`

Проверяет значение реквизита извлеченное из тела ответа на соответствие шаблону.

### Шаг: И Я сохраняю в переменную "count" количество элементов результата запроса

Метод: `ЯСохраняюВПеременнуюКоличествоЭлементовРезультатаЗапроса(ИмяПеременной)`

Сохраняет в переменную количество элементов ответа (например, количество записей удовлетворяющих условию)
для дальнейшего использования в сценариях

Примеры

```gherkin
# Поиск данных
И Я ищу записи "Справочник.Пользователи" внешней системы "RAT_REST" по условиям
  | Наименование    | Иванов Иван Иванович |
  | ПометкаУдаления | Ложь                 |
# Запомнили количество
И Я сохраняю в переменную "Количество" количество элементов результата запроса
И выражение внутреннего языка '$Количество$ >= 2' Истинно

```

### Шаг: И Количество элементов результата запроса равно "2"

Метод: `КоличествоЭлементовРезультатаЗапросаРавно(ОжидаемоеКоличество)`

Проверяет результат запроса, количество записей в результате

Примеры

```gherkin
И Я ищу записи "Справочник.Пользователи" внешней системы "RAT_REST" по условиям
  | Наименование    | Иванов Иван Иванович |
  | ПометкаУдаления | Ложь                 |
И количество элементов результата запроса равно "1"
```

### Цикл: И для каждого элемента "ИмяПеременной" результата запроса

Перебирает значения результата запроса.

Метод: `ДляКаждогоЭлементаРезультатаЗапроса(ИмяПеременной)`

Примеры

```gherkin
И Я получаю данные "Справочник.Пользователи" внешней системы "RAT_REST" по условиям
  | ПометкаУдаления      | Ложь               |
И для каждого элемента "Пользователь" результата запроса
  И Я удаляю запись "Справочник.Пользователи.{Пользователь.id}" внешней системы "RAT_REST"  
```

## Настройка запросов

### Шаг: И Я устанавливаю настройки подключения к внешней системе "jsonplaceholder"

Метод: `ЯУстанавливаюНастройкиПодключенияКВнешнейСистеме(ИмяНастройки, Настройки)`

Устанавливает параметры подключения к внешней системе.
Vanessa запомнит параметры подключения, которые можно будет использовать в последующих запросах к внешней системе.

Примеры

```gherkin
# На основании URL
И Я устанавливаю настройки подключения к внешней системе "jsonplaceholder"
  | Сервер  | https://jsonplaceholder.typicode.com/todos |
  | Таймаут | 30                                         |

# На основании параметров подключения
И Я устанавливаю настройки подключения к внешней системе "jsonplaceholder"
  | Сервер             | jsonplaceholder.typicode.com |
  | Схема              | https                        |
  | Ресурс             | todos                        |
  | Порт               | 443                          |
  | Таймаут            | 30                           |
  | Пользователь       |                              |
  | Пароль             |                              |
  # Настройки прокси: Использовать, ПроксиПоУмолчанию, АутентификацияОС, Сервер, Порт, Пользователь, Пароль
  | Прокси             | $НастройкиПрокси$            |
  # Запрос будет выполнятся на сервере 1С:Предприятия, иначе - на клиенте
  | ВыполнятьНаСервере | Истина                       |

И Я выполняю запрос "GET" к ресурсу "/posts" внешней системы "jsonplaceholder"
```

### Шаг: И Я устанавливаю заголовки запроса к внешней системе "jsonplaceholder"

Метод: `ЯУстанавливаюЗаголовкиЗапросаКВнешнейСистеме(ИмяНастройки, Заголовки)`

Добавляет заголовки http запроса, которые будут использоваться при каждом запросе к внешней системе

Примеры

```gherkin
И Я устанавливаю заголовки запроса к внешней системе "Площадка public API"
  | Authorization | Bearer $access_token$ |
```

### Шаг: И Я устанавливаю разрешенные коды ответов от внешней системы "jsonplaceholder"

Метод: `ЯУстанавливаюРазрешенныеКодыОтветовОтВнешнейСистемы(ИмяНастройки, КодыОтветов)`

Устанавливает коды ответов, которые считаются валидными.

При получении ответа, код ответа которого, отсутствует в разрешенных, будет выброшено исключение и шаг упадет

По умолчанию установлены коды: 200, 201, 202

Примеры

```gherkin
И Я устанавливаю разрешенные коды ответов от внешней системы "Площадка public API"
  | 404 |
```

### Шаг: И Я устанавливаю параметры задержки повторного запроса

Метод: `ЯУстанавливаюПараметрыЗадержкиПовторногоЗапроса(Параметры)`

Устанавливает параметры задержки (паузы) перед выполнением повторного запроса к внешней системе.  
Повторные запросы выполняются при изменении данных, когда была поймана ошибка блокировки данных `"Конфликт блокировок при выполнении транзакции"`.

Параметры применяются ко всем последующим запросам изменения данных.

Доступные параметры:

| Параметр                       | Описание                                                           | Значение по умолчанию |
|--------------------------------|--------------------------------------------------------------------|-----------------------|
| МаксимальноеКоличествоПопыток  | Количество повторных запросов, после которого шаг упадет по ошибке | 3                     |
| НачальныйИнтервал              | Начальная задержка, до следующего повторного запроса, сек          | 5                     |
| КоэффициентУвеличенияИнтервала | Множитель, для увеличения задержки                                 | 1.4                   |
| МаксимальныйИнтервал           | Максимальное значение интервала, сек                               | 15                    |

```js
// Пример расчета пауз между повторными запросами

МаксимальноеКоличествоПопыток = 5;
НачальныйИнтервал = 5;
КоэффициентУвеличенияИнтервала = 1.4;
МаксимальныйИнтервал = 15;

Пауза1 = НачальныйИнтервал; // 5
Пауза2 = Минимум(МаксимальныйИнтервал, Пауза1 * КоэффициентУвеличенияИнтервала); // 5 * 1.4 = 7
Пауза3 = Минимум(МаксимальныйИнтервал, Пауза2 * КоэффициентУвеличенияИнтервала); // 7 * 1.4 = 10(9.8)
Пауза4 = Минимум(МаксимальныйИнтервал, Пауза3 * КоэффициентУвеличенияИнтервала); // 10 * 1.4 = 14
Пауза5 = Минимум(МаксимальныйИнтервал, Пауза4 * КоэффициентУвеличенияИнтервала); // Минимум(15, 14 * 1.4) = Минимум(15, 19.6) = 15
// Если 5ая (МаксимальноеКоличествоПопыток) попытка оказалась неудачной, то шаг упадет по ошибке
```

При этом стоит учитывать, что запрос ожидающий снятия блокировки выполняется примерно 20 сек (это время указывается в настройках инф. базы). Те время между началом первого и второго запросом из примера будет 25 секунд (20 сек. - ожидание блокировки и 5 сек - пауза)

Примеры

```gherkin
И Я устанавливаю параметры задержки повторного запроса
  | НачальныйИнтервал             | 10 |
  | МаксимальныйИнтервал          | 60 |
  | МаксимальноеКоличествоПопыток | 5  |

И Я создаю запись "Справочник.ОбъектыМетаданных" внешней системы "ЭтаБаза"
```

## Выполнение запросов

### Шаг: И Я выполняю запрос "GET" к ресурсу "/posts" внешней системы "jsonplaceholder"

Метод: `ЯВыполняюЗапросКРесурсуВнешнейСистемы(Метод, Ресурс, ИмяНастройки)`

Выполняет http запрос к настроенному источнику данных по указанному адресу

| Параметр     | Описание                                                                     | Примеры               |
|--------------|------------------------------------------------------------------------------|-----------------------|
| ИмяНастройки | Имя настроенного источника данных                                            |                       |
| Метод        | HTTP метод, по умолчанию - GET                                               | GET, POST, PATCH      |
| Ресурс       | Адрес ресурса на сервисе, он добавляется к URL указанному в источнике данных | /posts, /api/v1/users |

Примеры

```gherkin
# Поиск по условиям
И Я выполняю запрос "GET" к ресурсу "/shippings" внешней системы "Площадка public API"
И Я выполняю запрос "DELETE" к ресурсу "/shippings/1" внешней системы "Площадка public API"
```

### Шаг: И Я выполняю запрос "POST" к ресурсу "/РегламентныеЗадания/Перезапустить" внешней системы "RAT_REST" с параметрами

Метод: `ЯВыполняюЗапросКРесурсуВнешнейСистемыСПараметрами(Метод, Ресурс, ИмяНастройки, ТаблицаПараметров)`

Выполняет http запрос с параметрами к настроенному источнику данных по указанному адресу

| Параметр          | Описание                                                                                                   | Примеры               |
|-------------------|------------------------------------------------------------------------------------------------------------|-----------------------|
| Метод             | HTTP метод, по умолчанию - GET                                                                             | GET, POST, PATCH      |
| Ресурс            | Адрес ресурса на сервисе, он добавляется к URL указанному в источнике данных                               | /posts, /api/v1/users |
| ИмяНастройки      | Имя настроенного источника данных                                                                          |                       |
| ТаблицаПараметров | Параметры запроса. Если выполняется GET запрос, то параметры подставляются в URL, если POST/PUT, то в тело |                       |

Примеры

```gherkin
# Авторизация
И Я выполняю запрос "POST" к ресурсу "/auth/token" внешней системы "jsonplaceholder" с параметрами
  | grant_type | password |
  | username   | user     |
  | password   | qwerty   |
# Подготовка данных
И Я задаю таблицу строк "Комментарии"
  | Первый |
  | Второй |
# Отправка данных на сервер
И Я выполняю запрос "POST" к ресурсу "/posts" внешней системы "jsonplaceholder" с параметрами
  | title  | Тестовый пост     |
  | body   | Это тестовый пост |
  | userId | 1                 |
  | comments | $Комментарии$   |
```

## Формирование данных

### Шаг: И Я создаю структуру "ДанныеПоста"

Метод: `ЯСоздаюСтруктуру(ИмяПеременной, ТаблицаДанных)`

Создает и помещает в переменные структуру данных.
Первая колонка - реквизиты, вторая - значения реквизитов

Примеры

```gherkin
И Я создаю структуру "ДанныеПоста"
  | title    | Тестовый пост     |
  | body     | Это тестовый пост |
  | userId   | 1                 |
  | comments | $Комментарии$     |
```

### Шаг: И Я создаю типизированную структуру "ДанныеПоста"

Метод: `ЯСоздаюТипизированнуюСтруктуру(ИмяПеременной, ТаблицаДанных)`

Создает и помещает в переменные структуру данных, значения которой типизированы - имеют описания типов.

Описание колонок

| Номер колонки | Описание                                                                                                                          |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------|
| 1             | Имя реквизита структуры, может содержать только буквы, цифры, символ подчеркивания. Начинается с буквы или символа подчеркивания. |
| 2             | Значение реквизита                                                                                                                |
| 3             | XML тип или имя объекта метаданных. Необязательное                                                                                |

Примеры XML типов:

| Тип                    | XML тип                |
|------------------------|------------------------|
| Число                  | decimal                |
| Булево                 | boolean                |
| Дата                   | dateTime               |
| Null                   | Null                   |
| ВидДвиженияБухгалтерии | AccountingRecordType   |
| ВидДвиженияНакопления  | AccumulationRecordType |
| Строка                 | string                 |

Примеры

```gherkin
И Я создаю типизированную структуру "ДанныеПоста"
  | title    | Тестовый пост       | string   |
  | body     | Это тестовый пост   | string   |
  | userId   | 1                   | decimal  |
  | date     | 1970-12-18T15:12:30 | dateTime |
  | comments | $Комментарии$       |          |
```

### Шаг: И Я создаю таблицу данных "ДанныеПоста"

Метод: `ЯСоздаюТаблицуДанных(ИмяПеременной, ТаблицаДанных)`

Создает и помещает в переменные таблицу данных.
Первая строка - заголовок, содержащий имена колонок, а потом идут строки данных

Примеры

```gherkin
И Я создаю таблицу данных "ДанныеПоста"
  | title         | body              | userId | comments      |
  | Тестовый пост | Это тестовый пост | 1      | $Комментарии$ |
```

### Шаг: И Я создаю переменную "Ссылка" с типом "Справочник.Пользователи" и значением "ИмяПользователя"

Метод: `ЯСоздаюПеременнуюСТипомИЗначением(ИмяПеременной, ИмяТипа, Значение)`

Создает и помещает в переменные типизированное значение.

Параметры

| Параметр      | Описание                                                                                                     |
|---------------|--------------------------------------------------------------------------------------------------------------|
| ИмяПеременной | Имя может содержать только буквы, цифры, символ подчеркивания. Начинается с буквы или символа подчеркивания. |
| ИмяТипа       | XML тип или имя объекта метаданных                                                                           |
| Значение      | Значение переменной                                                                                          |

Примеры XML типов:

| Тип                    | XML тип                |
|------------------------|------------------------|
| Число                  | decimal                |
| Булево                 | boolean                |
| Дата                   | dateTime               |
| Null                   | Null                   |
| ВидДвиженияБухгалтерии | AccountingRecordType   |
| ВидДвиженияНакопления  | AccumulationRecordType |
| Строка                 | string                 |

Примеры

```gherkin
И Я создаю переменную "Ссылка" с типом "Справочник.Пользователи" и значением "ИмяПользователя"
И Я создаю переменную "Дата" с типом "dateTime" и значением "1970-12-18T15:12:30"
И Я создаю переменную "ВидДвижения" с типом "AccumulationRecordType" и значением "Приход"
```

### Шаг: И Я создаю массив "ДанныеПоста"

Метод: `ЯСоздаюМассив(ИмяПеременной, ТаблицаДанных)`

Создает и помещает в переменные массив значений.

Позволяет создать массив из таблицы геркен, строки с разделителем ";" или пустой массив.

Примеры

```gherkin
Когда Я создаю массив "Данные"
    | Строка |
    | Число  |
    | Булево |
И Я создаю массив "ДанныеИзСтроки" "Строка;Число;Булево"
И Я создаю массив "ПустойМассив" ""
```

## Обычные формы

### Шаг: И Я сохраняю печатную форму "Счет" документа "ПКО.00000001" в переменную "ПФ_Счет"

Метод: `ЯСохраняюПечатнуюФормуДокументаВПеременную(ИмяПечатнойФормы, ИдентификаторДокумента, ИмяПеременной, Параметры)`

Формирует печатную форму указанного документа и сохраняет ее в переменную для дальнейшего использования.

## Проверка значений

### Шаг: И Табличный документ из переменной "ПФ_Счет" равен макету "ИмяМакета" по шаблону

Метод: `ТабличныйДокументИзПеременнойРавенМакетуПоШаблону(ИмяПеременной, ИмяЭталонногоМакета)`

Шаг позволяет проверить, что табличный документ соответствует эталону. Если в ячейке эталона будет только один символ *, 
то такая ячейка не будет участвовать в сравнении. 
В значениях эталонного макета допускается использовать символы *. 
Макет ищется в каталоге проекта.

### Шаг: И в табличном документе из переменной "ПФ_Счет" и макете "ИмяМакета" одинаковые изображения

Метод: `ВТабличномДокументеИзПеременнойИМакетеОдинаковыеИзображения(ИмяПеременной, ИмяЭталонногоМакета)`

Шаг позволяет проверить, что картинки табличного документа соответствуют картинкам эталона.

Изображения сравниваются:

* по содержимому, они должны быть абсолютно одинаковыми;
* по положению в табличном документе;
* по размерам.

Макет ищется в каталоге проекта.

# Взаимодействие с клиентом тестирования

## Анализ табличных документов

### Шаг: Свойства ячейки "Текущая ячейка" элемента "Текущий элемент" соответствуют предикату "ЦветФона: 255,0,0"

Метод: `СвойстваЯчейкиЭлементаСоответствуютПредикату(ИмяОбласти, ИмяЭлемента, ОписаниеПредиката)`

Проверяет свойства заданной ячейки (области) заданного табличного документа (размещенного в элементе активной управляемой формы) на соответствие заданным условиям (описанию предиката).
При обнаружении расхождений свойств ячейки с заданными условиями генерируется ошибка.
Так же ошибка будет сгенерирована при отсутствии активной формы, активного элемента табличного документа или соответствующей области табличного документа.

Ячейка задается в виде имени области:
Имя области или адрес в формате "R1C1:R2C2", где число после "R" обозначает номер строки, число после "C" - номер колонки,
символом ":" (двоеточие) разделяются координаты левого верхнего и правого нижнего угла области.
В качестве имени также можно передавать пересечение двух областей, записываемое как "&lt;Имя области 1&gt; | &lt;Имя области 2&gt;"

ВНИМАНИЕ! В качестве имени ячейки поддерживаются специальные токены:
 - "Текущая ячейка" - будет использована текущая активная ячейка (область) элемента, отображающего табличный документ
 - "Содержит текст:произвольный текст" - определяется первая ячейка, содержащая заданный текст (регистр не учитывается, концевые пробелы учитываются)

Имя элемента соответсвует имени элемента активной формы, отображающего табличный документ.
ВНИМАНИЕ! для использования текущего активного элемента предусмотрено ключевое слово (используется вместо имени элемента) - "Текущий элемент"

Условия сравнения (предикат) задаются в виде строки. Описание отдельных свойств разделяются символом `;`, имя свойства отделяется от значения символом `:`.
Допускается многострочное написание предиката (по правилам gherkin)

Системные требования:
 - Менеджер и Клиент тестирования запущены на одной информационной базе
 - Версия платформы не ниже 8.3.19

Пример:

```gherkin
И Свойства ячейки "Текущая ячейка" элемента "Текущий элемент" соответствуют предикату "ЦветФона: 255,255,255; ЦветТекста: WebЦвета.ЗеленаяЛужайка; Узор: БезУзора; Текст: мама мыла раму"
И Свойства ячейки "Содержит текст:мама мыла" элемента "Текущий элемент" соответствуют предикату "ЦветФона: 255,255,255; ЦветТекста: WebЦвета.ЗеленаяЛужайка; Узор: БезУзора; Текст: мама мыла раму"
И Свойства ячейки "R1C1:R1C1" элемента "Текущий элемент" соответствуют предикату "ЦветФона: 255,255,255; ЦветТекста: WebЦвета.ЗеленаяЛужайка; Узор: БезУзора; Текст: мама мыла раму"
```

Поддерживаются следующие свойства ячейки:

| Свойство                | Описание                                                                                    | Примеры                                                             |
|-------------------------|---------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
| Цвет*                   | определяет соответствующий цвет оформления: ЦветФона, ЦветТекста, ЦветРамки, ЦветУзора      | ЦветФона: 255,255,255; ЦветТекста: WebЦвета.ЗеленаяЛужайка          |
|                         | поддерживается указание цвета в следующий форматах:                                         |                                                                     |
|                         |  - в виде трех компонент (R, G, B), например:  255,255,255                                  |                                                                     |
|                         |  - в виде значения коллекции WebЦвета, например:  WebЦвета.ЗеленаяЛужайка                   |                                                                     |
|                         |  - в виде значения коллекции WindowsЦвета, например:  WindowsЦвета.ЗаголовокНеактивногоОкна |                                                                     |
|                         |  - в виде значения коллекции ЦветаСтиля, например:  ЦветаСтиля.ЦветОсобогоТекста            |                                                                     |
|                         | возможные значения цветов выше указанных коллекций смотри в справке к платформе             |                                                                     |
| ВертикальноеПоложение   | определяет вертикальное выравнивание текста в ячейке, возможные значения:                   | ВертикальноеПоложение: Верх                                         |
|                         |  - Верх, Низ, Центр                                                                         |                                                                     |
| ГоризонтальноеПоложение | определяет горизонтальное выравнивание текста в ячейке, возможные значения:                 | ГоризонтальноеПоложение: ПоШирине                                   |
|                         |  - Авто, Лево, ПоШирине, Право, Центр                                                       |                                                                     |
| Узор                    | определяет узор фона ячейки, возможные значения:                                            | Узор: Узор12                                                        |
|                         |  - БезУзора, Сплошной, Узор1, Узор2 ... Узор17                                              |                                                                     |
| Текст                   | определяет текст ячейки.                                                                    | Текст: мама мыла раму                                               |     
|                         | Внимание! при инлайн описании предиката имеются ограничения на допустимые символы в тексте, |                                                                     |
|                         | Недопускаются символы: `;` и `:`                                                            |                                                                     |
|                         | Сравнение выполняется на полное соответствие включая регистр написания символов             |                                                                     | 

### Шаг: Я запоминаю значения свойств "ЦветФона, ЦветТекста" ячейки "Текущая ячейка" элемента "Текущий элемент" в переменную "ИмяПеременной"

Метод: `ЯЗапоминаюЗначенияСвойствЯчейкиЭлементаВПеременную(ИменаСвойств, ИмяОбласти, ИмяЭлемента, ИмяПеременной)`

Получает значения указанных свойств (имена свойств указываются через запятую) для заданной ячейки табличного документа (размещенного в элементе активной управляемой формы) и запоминает их
в указанной переменной. В случае невозможности получить ячейку, табличный документ или определить активную форму - вызывает исключение.
Значения свойств сохраняются в виде структуры. Поддерживаются свойства: ЦветФона, ЦветТекста, ЦветРамки, ЦветУзора, ВертикальноеПоложение, ГоризонтальноеПоложение, Узор, Текст
и другие свойства табличного документа, доступные на "клиенте".

Ячейка задается в виде имени области:
Имя области или адрес в формате "R1C1:R2C2", где число после "R" обозначает номер строки, число после "C" - номер колонки,
символом ":" (двоеточие) разделяются координаты левого верхнего и правого нижнего угла области.
В качестве имени также можно передавать пересечение двух областей, записываемое как "&lt;Имя области 1&gt; | &lt;Имя области 2&gt;"

ВНИМАНИЕ! В качестве имени ячейки поддерживаются специальные токены:
 - "Текущая ячейка" - будет использована текущая активная ячейка (область) элемента, отображающего табличный документ
 - "Содержит текст:произвольный текст" - определяется первая ячейка, содержащая заданный текст (регистр не учитывается, концевые пробелы учитываются)

Имя элемента соответсвует имени элемента активной формы, отображающего табличный документ.
ВНИМАНИЕ! для использования текущего активного элемента предусмотрено ключевое слово (используется вместо имени элемента) - "Текущий элемент" 

Системные требования:
 - Менеджер и Клиент тестирования запущены на одной информационной базе
 - Версия платформы не ниже 8.3.19
 
Пример:

```gherkin
И Я запоминаю значения свойств "ЦветФона, ЦветТекста" ячейки "Текущая ячейка" элемента "Текущий элемент" в переменную "ОформлениеЯчейки"
```

### Шаг: Значения свойств переменной "ИмяПеременной" соответствует предикату "ОписаниеПредиката"

Метод: `ЗначенияСвойствПеременнойСоответствуетПредикату(ИмяПеременной, ОписаниеПредиката)`

Проверяет соответствие свойств значения, сохраненного в переменной, на соответствие заданному описанию предиката. 
Условия сравнения (предикат) задаются в виде строки. Описание отдельных свойств разделяются символом `;`, имя свойства отделяется от значения символом `:`.
Допускается многострочное написание предиката (по правилам gherkin)

Системные требования:
 - Менеджер и Клиент тестирования запущены на одной информационной базе
 - Версия платформы не ниже 8.3.19
 
Пример:

```gherkin
И Значения свойств переменной "ОформлениеЯчейки" соответствуют предикату "ЦветФона: 255,0,0; Узор: Узор1"
``` 

Поддерживаются следующие свойства в описании предиката:

| Свойство                | Описание                                                                                    | Примеры                                                             |
|-------------------------|---------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
| Цвет*                   | определяет соответствующий цвет оформления: ЦветФона, ЦветТекста, ЦветРамки, ЦветУзора      | ЦветФона: 255,255,255; ЦветТекста: WebЦвета.ЗеленаяЛужайка          |
|                         | поддерживается указание цвета в следующий форматах:                                         |                                                                     |
|                         |  - в виде трех компонент (R, G, B), например:  255,255,255                                  |                                                                     |
|                         |  - в виде значения коллекции WebЦвета, например:  WebЦвета.ЗеленаяЛужайка                   |                                                                     |
|                         |  - в виде значения коллекции WindowsЦвета, например:  WindowsЦвета.ЗаголовокНеактивногоОкна |                                                                     |
|                         |  - в виде значения коллекции ЦветаСтиля, например:  ЦветаСтиля.ЦветОсобогоТекста            |                                                                     |
|                         | возможные значения цветов выше указанных коллекций смотри в справке к платформе             |                                                                     |
| ВертикальноеПоложение   | определяет вертикальное выравнивание текста в ячейке, возможные значения:                   | ВертикальноеПоложение: Верх                                         |
|                         |  - Верх, Низ, Центр                                                                         |                                                                     |
| ГоризонтальноеПоложение | определяет горизонтальное выравнивание текста в ячейке, возможные значения:                 | ГоризонтальноеПоложение: ПоШирине                                   |
|                         |  - Авто, Лево, ПоШирине, Право, Центр                                                       |                                                                     |
| Узор                    | определяет узор фона ячейки, возможные значения:                                            | Узор: Узор12                                                        |
|                         |  - БезУзора, Сплошной, Узор1, Узор2 ... Узор17                                              |                                                                     |
| Текст                   | определяет текст ячейки.                                                                    | Текст: мама мыла раму                                               |     
|                         | Внимание! при инлайн описании предиката имеются ограничения на допустимые символы в тексте, |                                                                     |
|                         | Недопускаются символы: `;` и `:`                                                            |                                                                     |
|                         | Сравнение выполняется на полное соответствие включая регистр написания символов             |                                                                     |

## Эмуляция действий пользователя

### Шаг: Я эмулирую вызов контекстного меню

Метод: `ЯЭмулируюВызовКонтекстногоМеню()`

Эмулирует вызов контекстного меню на клиенте тестирования (эмулируется вызов сочетания клавиш: SHIFT+F10)

Системные требования:
 - Менеджер и Клиент тестирования запущены на одной информационной базе
 - Версия платформы не ниже 8.3.19
 - клиент тестирования запускается на ОС Windows
 - на клиенте тестирования установлен WScript.Shell (обычно входит в поставку ОС) 
 
### Шаг: Я эмулирую нажатие Ввод

Метод: `ЯЭмулируюНажатиеВвод()`

Эмулирует нажатие клавиши Enter (ввод) на клиенте тестирования

Системные требования:
 - Менеджер и Клиент тестирования запущены на одной информационной базе
 - Версия платформы не ниже 8.3.19
 - клиент тестирования запускается на ОС Windows
 - на клиенте тестирования установлен WScript.Shell (обычно входит в поставку ОС)
